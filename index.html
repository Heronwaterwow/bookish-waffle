<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>dApp - Deep Link Router</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            color: #666;
            font-size: 1.1rem;
        }

        .navigation {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .nav-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .nav-link {
            padding: 12px 24px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            text-decoration: none;
            border-radius: 25px;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .nav-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .nav-link.active {
            background: linear-gradient(45deg, #764ba2, #667eea);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.6);
        }

        .content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            min-height: 400px;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .wallet-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
        }

        .wallet-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .wallet-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.2s;
            cursor: pointer;
        }

        .wallet-card:hover {
            transform: translateY(-5px);
        }

        .wallet-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: white;
        }

        .phantom { background: #ab9ff2; }
        .safepal { background: #1890ff; }
        .trust { background: #3375bb; }
        .coinbase { background: #0052ff; }
        .metamask { background: #f6851b; }

        .device-info {
            background: #e3f2fd;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .device-info h3 {
            color: #1976d2;
            margin-bottom: 10px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .info-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            position: relative;
            animation: slideIn 0.3s;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            right: 20px;
            top: 15px;
        }

        .close:hover {
            color: #000;
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            margin: 10px 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .alert {
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }

        .alert-info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }

        .alert-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }

        .alert-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .nav-links {
                flex-direction: column;
                align-items: center;
            }
            
            .content {
                padding: 20px;
            }
        }

        #debug-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
            max-width: 300px;
            font-size: 12px;
            z-index: 999;
            display: none;
        }

        .debug-toggle {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: #667eea;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            z-index: 999;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üîó dApp Deep Link Router</h1>
            <p>–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∏–ø–ª–∏–Ω–∫–æ–≤ –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ —Å–∞–π—Ç—É</p>
        </div>

        <!-- Navigation -->
        <div class="navigation">
            <div class="nav-links">
                <a href="#home" class="nav-link active" data-page="home">üè† –ì–ª–∞–≤–Ω–∞—è</a>
                <a href="#wallet" class="nav-link" data-page="wallet">üíº –ö–æ—à–µ–ª—å–∫–∏</a>
                <a href="#dapp" class="nav-link" data-page="dapp">‚ö° dApp</a>
                <a href="#info" class="nav-link" data-page="info">‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</a>
                <a href="#settings" class="nav-link" data-page="settings">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
            </div>
        </div>

        <!-- Content -->
        <div class="content">
            <!-- Home Page -->
            <div id="home" class="page active">
                <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ dApp</h2>
                <p>–≠—Ç–æ—Ç —Å–∞–π—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∏–ø–ª–∏–Ω–∫–æ–≤ –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏.</p>
                
                <div class="alert alert-info">
                    <strong>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong> –î–∏–ø–ª–∏–Ω–∫–∏ —Ç–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∏ –Ω–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—é—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –∫–æ—à–µ–ª–µ–∫ –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.
                </div>

                <div class="device-info">
                    <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <strong>–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ:</strong>
                            <div id="device-type">–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è...</div>
                        </div>
                        <div class="info-item">
                            <strong>–ë—Ä–∞—É–∑–µ—Ä:</strong>
                            <div id="browser-type">–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è...</div>
                        </div>
                        <div class="info-item">
                            <strong>–ö–æ—à–µ–ª–µ–∫:</strong>
                            <div id="wallet-browser">–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è...</div>
                        </div>
                        <div class="info-item">
                            <strong>URL:</strong>
                            <div id="current-url">–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è...</div>
                        </div>
                    </div>
                </div>

                <button class="btn" onclick="testDeepLink()">üîó –¢–µ—Å—Ç –¥–∏–ø–ª–∏–Ω–∫–∞</button>
                <button class="btn btn-secondary" onclick="showDeviceInfo()">üì± –ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</button>
            </div>

            <!-- Wallet Page -->
            <div id="wallet" class="page">
                <h2>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞</h2>
                <p>–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ—à–µ–ª–µ–∫ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ dApp:</p>

                <div class="wallet-section">
                    <h3>–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ—à–µ–ª—å–∫–∏</h3>
                    <div class="wallet-grid">
                        <div class="wallet-card" onclick="handleWalletConnection('phantom')">
                            <div class="wallet-icon phantom">P</div>
                            <h4>Phantom</h4>
                            <p>Solana –∫–æ—à–µ–ª–µ–∫</p>
                        </div>
                        <div class="wallet-card" onclick="handleWalletConnection('safepal')">
                            <div class="wallet-icon safepal">S</div>
                            <h4>SafePal</h4>
                            <p>–ú—É–ª—å—Ç–∏-–±–ª–æ–∫—á–µ–π–Ω</p>
                        </div>
                        <div class="wallet-card" onclick="handleWalletConnection('trust')">
                            <div class="wallet-icon trust">T</div>
                            <h4>Trust Wallet</h4>
                            <p>–ú–æ–±–∏–ª—å–Ω—ã–π –∫–æ—à–µ–ª–µ–∫</p>
                        </div>
                        <div class="wallet-card" onclick="handleWalletConnection('coinbase')">
                            <div class="wallet-icon coinbase">C</div>
                            <h4>Coinbase Wallet</h4>
                            <p>–°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π –∫–æ—à–µ–ª–µ–∫</p>
                        </div>
                        <div class="wallet-card" onclick="handleWalletConnection('metamask')">
                            <div class="wallet-icon metamask">M</div>
                            <h4>MetaMask</h4>
                            <p>Ethereum –∫–æ—à–µ–ª–µ–∫</p>
                        </div>
                    </div>
                </div>

                <div class="alert alert-warning">
                    <strong>–í–Ω–∏–º–∞–Ω–∏–µ:</strong> –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —è–≤–Ω–æ–º –¥–µ–π—Å—Ç–≤–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
                </div>
            </div>

            <!-- dApp Page -->
            <div id="dapp" class="page">
                <h2>dApp –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å</h2>
                <p>–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:</p>

                <div class="wallet-section">
                    <h3>–§—É–Ω–∫—Ü–∏–∏ dApp</h3>
                    <button class="btn" onclick="connectWallet()">üîó –ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫–æ—à–µ–ª–µ–∫</button>
                    <button class="btn" onclick="checkBalance()">üí∞ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å</button>
                    <button class="btn" onclick="sendTransaction()">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é</button>
                    <button class="btn" onclick="viewNFTs()">üñºÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä NFT</button>
                </div>

                <div id="dapp-status" class="alert alert-info">
                    <strong>–°—Ç–∞—Ç—É—Å:</strong> –ì–æ—Ç–æ–≤ –∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é –∫–æ—à–µ–ª—å–∫–∞
                </div>
            </div>

            <!-- Info Page -->
            <div id="info" class="page">
                <h2>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–∏–ø–ª–∏–Ω–∫–∞—Ö</h2>
                <p>–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–º, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –¥–∏–ø–ª–∏–Ω–∫–∏ –≤ —ç—Ç–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:</p>

                <div class="wallet-section">
                    <h3>–ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –¥–∏–ø–ª–∏–Ω–∫–∏</h3>
                    <ol>
                        <li><strong>–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:</strong> –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏ –±—Ä–∞—É–∑–µ—Ä</li>
                        <li><strong>–ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞:</strong> –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –∫–æ—à–µ–ª–µ–∫</li>
                        <li><strong>–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è:</strong> –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏</li>
                        <li><strong>–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:</strong> –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø—Ä–∏ –Ω–µ—É–¥–∞—á–µ</li>
                    </ol>

                    <h3>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –¥–∏–ø–ª–∏–Ω–∫–∏</h3>
                    <ul>
                        <li><code>phantom://</code> - Phantom –∫–æ—à–µ–ª–µ–∫</li>
                        <li><code>trust://</code> - Trust Wallet</li>
                        <li><code>safepal://</code> - SafePal –∫–æ—à–µ–ª–µ–∫</li>
                        <li><code>cbwallet://</code> - Coinbase Wallet</li>
                        <li><code>metamask://</code> - MetaMask</li>
                    </ul>
                </div>
            </div>

            <!-- Settings Page -->
            <div id="settings" class="page">
                <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                <p>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –¥–∏–ø–ª–∏–Ω–∫–æ–≤:</p>

                <div class="wallet-section">
                    <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–∏–ø–ª–∏–Ω–∫–æ–≤</h3>
                    <label>
                        <input type="checkbox" id="auto-redirect" checked> 
                        –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
                    </label><br><br>
                    
                    <label>
                        <input type="checkbox" id="show-instructions" checked> 
                        –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø—Ä–∏ –Ω–µ—É–¥–∞—á–Ω–æ–º –¥–∏–ø–ª–∏–Ω–∫–µ
                    </label><br><br>
                    
                    <label>
                        <input type="checkbox" id="debug-mode"> 
                        –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏
                    </label><br><br>

                    <h3>–ü—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ—à–µ–ª–µ–∫</h3>
                    <select id="preferred-wallet">
                        <option value="auto">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä</option>
                        <option value="phantom">Phantom</option>
                        <option value="trust">Trust Wallet</option>
                        <option value="safepal">SafePal</option>
                        <option value="coinbase">Coinbase Wallet</option>
                        <option value="metamask">MetaMask</option>
                    </select><br><br>

                    <button class="btn" onclick="saveSettings()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                    <button class="btn btn-secondary" onclick="resetSettings()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for wallet connection -->
    <div id="walletModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('walletModal')">&times;</span>
            <h2>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞</h2>
            <p id="wallet-modal-text">–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:</p>
            <div id="wallet-modal-buttons">
                <!-- –ö–Ω–æ–ø–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
    </div>

    <!-- Debug Panel -->
    <button class="debug-toggle" onclick="toggleDebug()">üêõ</button>
    <div id="debug-panel">
        <h4>Debug Panel</h4>
        <div id="debug-content"></div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        const APP_CONFIG = {
            baseUrl: 'https://heronwaterwow.github.io/bookish-waffle/',
            debugMode: false,
            autoRedirect: true,
            showInstructions: true,
            preferredWallet: 'auto'
        };

        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ—à–µ–ª—å–∫–æ–≤
        const WALLET_CONFIG = {
            phantom: {
                name: "Phantom",
                scheme: "phantom://",
                universalLink: "https://phantom.app/ul/browse/",
                userAgentPattern: /phantom/i,
                downloadUrls: {
                    ios: "https://apps.apple.com/app/phantom-solana-wallet/id1598432977",
                    android: "https://play.google.com/store/apps/details?id=app.phantom"
                }
            },
            trust: {
                name: "Trust Wallet",
                scheme: "trust://",
                universalLink: "https://link.trustwallet.com/open_url?url=",
                userAgentPattern: /trust/i,
                downloadUrls: {
                    ios: "https://apps.apple.com/app/trust-crypto-bitcoin-wallet/id1288339409",
                    android: "https://play.google.com/store/apps/details?id=com.wallet.crypto.trustapp"
                }
            },
            safepal: {
                name: "SafePal",
                scheme: "safepal://",
                universalLink: "https://link.safepal.io/dapp?url=",
                userAgentPattern: /safepal/i,
                downloadUrls: {
                    ios: "https://apps.apple.com/app/safepal-wallet/id1548297139",
                    android: "https://play.google.com/store/apps/details?id=io.safepal.wallet"
                }
            },
            coinbase: {
                name: "Coinbase Wallet",
                scheme: "cbwallet://",
                universalLink: "https://go.cb-w.com/dapp?cb_url=",
                userAgentPattern: /coinbasewallet|coinbase/i,
                downloadUrls: {
                    ios: "https://apps.apple.com/app/coinbase-wallet-nfts-crypto/id1278383455",
                    android: "https://play.google.com/store/apps/details?id=org.toshi"
                }
            },
            metamask: {
                name: "MetaMask",
                scheme: "metamask://",
                universalLink: "https://metamask.app.link/dapp/",
                userAgentPattern: /metamask/i,
                downloadUrls: {
                    ios: "https://apps.apple.com/app/metamask/id1438144202",
                    android: "https://play.google.com/store/apps/details?id=io.metamask"
                }
            }
        };

        // –ö–ª–∞—Å—Å –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
        class DeviceDetector {
            constructor() {
                this.userAgent = navigator.userAgent.toLowerCase();
            }

            isMobile() {
                return /android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(this.userAgent);
            }

            isIOS() {
                return /iphone|ipad|ipod/i.test(this.userAgent);
            }

            isAndroid() {
                return /android/i.test(this.userAgent);
            }

            getBrowser() {
                if (/safari/i.test(this.userAgent) && !/chrome|chromium|edg/i.test(this.userAgent)) return 'Safari';
                if (/chrome/i.test(this.userAgent) && !/edg/i.test(this.userAgent)) return 'Chrome';
                if (/firefox/i.test(this.userAgent)) return 'Firefox';
                if (/edg/i.test(this.userAgent)) return 'Edge';
                if (/yabrowser/i.test(this.userAgent)) return '–Ø–Ω–¥–µ–∫—Å.–ë—Ä–∞—É–∑–µ—Ä';
                if (/opera/i.test(this.userAgent)) return 'Opera';
                return '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä';
            }

            getWalletBrowser() {
                for (const [key, wallet] of Object.entries(WALLET_CONFIG)) {
                    if (wallet.userAgentPattern.test(this.userAgent)) {
                        return key;
                    }
                }
                return null;
            }

            getDeviceType() {
                if (this.isIOS()) return 'iOS';
                if (this.isAndroid()) return 'Android';
                if (this.isMobile()) return '–ú–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ';
                return '–î–µ—Å–∫—Ç–æ–ø';
            }
        }

        // –ö–ª–∞—Å—Å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∏–ø–ª–∏–Ω–∫–æ–≤
        class DeepLinkRouter {
            constructor() {
                this.deviceDetector = new DeviceDetector();
                this.currentPage = 'home';
                this.init();
            }

            init() {
                this.handleInitialRoute();
                this.setupEventListeners();
                this.updateDeviceInfo();
                this.loadSettings();
            }

            handleInitialRoute() {
                const hash = window.location.hash.slice(1);
                const urlParams = new URLSearchParams(window.location.search);
                
                debug(`–ù–∞—á–∞–ª—å–Ω—ã–π —Ä–æ—É—Ç–∏–Ω–≥: hash=${hash}, search=${window.location.search}`);

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –¥–∏–ø–ª–∏–Ω–∫–∞
                const walletParam = urlParams.get('wallet');
                const actionParam = urlParams.get('action');

                if (walletParam && actionParam === 'connect') {
                    debug(`–û–±–Ω–∞—Ä—É–∂–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä –∫–æ—à–µ–ª—å–∫–∞: ${walletParam}`);
                    this.handleWalletDeepLink(walletParam);
                    return;
                }

                // –û–±—ã—á–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º
                if (hash && this.isValidPage(hash)) {
                    this.navigateToPage(hash);
                } else {
                    this.navigateToPage('home');
                }
            }

            handleWalletDeepLink(walletType) {
                debug(`–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∏–ø–ª–∏–Ω–∫–∞ –∫–æ—à–µ–ª—å–∫–∞: ${walletType}`);
                
                // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–æ—à–µ–ª—å–∫–æ–≤
                this.navigateToPage('wallet');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏
                setTimeout(() => {
                    this.showWalletConnectionInfo(walletType);
                }, 500);
            }

            showWalletConnectionInfo(walletType) {
                const wallet = WALLET_CONFIG[walletType];
                if (!wallet) return;

                const alertDiv = document.createElement('div');
                alertDiv.className = 'alert alert-success';
                alertDiv.innerHTML = `
                    <strong>–î–∏–ø–ª–∏–Ω–∫ –æ–±—Ä–∞–±–æ—Ç–∞–Ω!</strong> 
                    –ó–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞ ${wallet.name}. 
                    <button class="btn" onclick="deepLinkRouter.connectWallet('${walletType}')">
                        –ü–æ–¥–∫–ª—é—á–∏—Ç—å ${wallet.name}
                    </button>
                `;

                const walletPage = document.getElementById('wallet');
                walletPage.insertBefore(alertDiv, walletPage.firstChild);

                // –£–¥–∞–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥
                setTimeout(() => {
                    if (alertDiv.parentNode) {
                        alertDiv.parentNode.removeChild(alertDiv);
                    }
                }, 10000);
            }

            isValidPage(page) {
                return ['home', 'wallet', 'dapp', 'info', 'settings'].includes(page);
            }

            navigateToPage(page) {
                debug(`–ù–∞–≤–∏–≥–∞—Ü–∏—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É: ${page}`);
                
                // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                document.querySelectorAll('.page').forEach(p => {
                    p.classList.remove('active');
                });

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
                const targetPage = document.getElementById(page);
                if (targetPage) {
                    targetPage.classList.add('active');
                    this.currentPage = page;
                }

                // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('active');
                    if (link.dataset.page === page) {
                        link.classList.add('active');
                    }
                });

                // –û–±–Ω–æ–≤–ª—è–µ–º URL –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
                history.pushState({page}, '', `#${page}`);
            }

            setupEventListeners() {
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –ø–æ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const page = link.dataset.page;
                        this.navigateToPage(page);
                    });
                });

                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ "–Ω–∞–∑–∞–¥" –±—Ä–∞—É–∑–µ—Ä–∞
                window.addEventListener('popstate', (e) => {
                    const page = e.state?.page || 'home';
                    this.navigateToPage(page);
                });
            }

            updateDeviceInfo() {
                document.getElementById('device-type').textContent = this.deviceDetector.getDeviceType();
                document.getElementById('browser-type').textContent = this.deviceDetector.getBrowser();
                
                const walletBrowser = this.deviceDetector.getWalletBrowser();
                document.getElementById('wallet-browser').textContent = walletBrowser ? 
                    `${WALLET_CONFIG[walletBrowser].name} –±—Ä–∞—É–∑–µ—Ä` : '–û–±—ã—á–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä';
                
                document.getElementById('current-url').textContent = window.location.href;
            }

            connectWallet(walletType) {
                debug(`–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞: ${walletType}`);
                
                const wallet = WALLET_CONFIG[walletType];
                if (!wallet) {
                    debug(`–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∫–æ—à–µ–ª–µ–∫: ${walletType}`);
                    return;
                }

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—Ö–æ–¥–∏–º—Å—è –ª–∏ –º—ã —É–∂–µ –≤ –∫–æ—à–µ–ª—å–∫–æ–≤–æ–º –±—Ä–∞—É–∑–µ—Ä–µ
                const currentWalletBrowser = this.deviceDetector.getWalletBrowser();
                
                if (currentWalletBrowser === walletType) {
                    debug(`–£–∂–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ ${wallet.name}, –ø–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞–ø—Ä—è–º—É—é`);
                    this.connectWalletDirectly(walletType);
                    return;
                }

                // –ï—Å–ª–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ –∏ –Ω–µ –≤ –∫–æ—à–µ–ª—å–∫–æ–≤–æ–º –±—Ä–∞—É–∑–µ—Ä–µ
                if (this.deviceDetector.isMobile() && !currentWalletBrowser && APP_CONFIG.autoRedirect) {
                    debug(`–ú–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ, –æ—Ç–∫—Ä—ã–≤–∞–µ–º ${wallet.name}`);
                    this.openWalletApp(walletType);
                    return;
                }

                // –í –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                this.showWalletModal(walletType);
            }

            connectWalletDirectly(walletType) {
                debug(`–ü—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ ${walletType}`);
                
                // –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä–µ–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∫–æ—à–µ–ª—å–∫—É
                // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—à–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
                
                const statusDiv = document.getElementById('dapp-status');
                if (statusDiv) {
                    statusDiv.className = 'alert alert-success';
                    statusDiv.innerHTML = `<strong>–£—Å–ø–µ—à–Ω–æ!</strong> –ö–æ—à–µ–ª–µ–∫ ${WALLET_CONFIG[walletType].name} –ø–æ–¥–∫–ª—é—á–µ–Ω.`;
                }

                alert(`–ö–æ—à–µ–ª–µ–∫ ${WALLET_CONFIG[walletType].name} —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω!`);
            }

            openWalletApp(walletType) {
                const wallet = WALLET_CONFIG[walletType];
                const targetUrl = `${APP_CONFIG.baseUrl}?wallet=${walletType}&action=connect`;
                
                debug(`–û—Ç–∫—Ä—ã–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ${wallet.name} —Å URL: ${targetUrl}`);

                // –ü—Ä–æ–±—É–µ–º —Å—Ö–µ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
                const deepLink = `${wallet.scheme}open?url=${encodeURIComponent(targetUrl)}`;
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–∞—É—Ç –¥–ª—è –ø–æ–∫–∞–∑–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π
                const timeout = setTimeout(() => {
                    if (APP_CONFIG.showInstructions) {
                        this.showInstallInstructions(walletType);
                    }
                }, 2500);

                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞
                const handleVisibilityChange = () => {
                    if (document.hidden) {
                        clearTimeout(timeout);
                        document.removeEventListener('visibilitychange', handleVisibilityChange);
                        debug(`–£—Å–ø–µ—à–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –≤ ${wallet.name}`);
                    }
                };

                document.addEventListener('visibilitychange', handleVisibilityChange);

                // –ü—ã—Ç–∞–µ–º—Å—è –æ—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
                try {
                    window.location.href = deepLink;
                } catch (error) {
                    debug(`–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –¥–∏–ø–ª–∏–Ω–∫–∞: ${error.message}`);
                    clearTimeout(timeout);
                    this.showInstallInstructions(walletType);
                }
            }

            showWalletModal(walletType) {
                const wallet = WALLET_CONFIG[walletType];
                const modal = document.getElementById('walletModal');
                const modalText = document.getElementById('wallet-modal-text');
                const modalButtons = document.getElementById('wallet-modal-buttons');

                modalText.textContent = `–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ ${wallet.name}`;
                
                modalButtons.innerHTML = `
                    <button class="btn" onclick="deepLinkRouter.connectWalletDirectly('${walletType}')">
                        üîó –ü–æ–¥–∫–ª—é—á–∏—Ç—å –Ω–∞–ø—Ä—è–º—É—é
                    </button>
                    <button class="btn" onclick="deepLinkRouter.openWalletApp('${walletType}')">
                        üì± –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
                    </button>
                    <button class="btn btn-secondary" onclick="closeModal('walletModal')">
                        ‚ùå –û—Ç–º–µ–Ω–∞
                    </button>
                `;

                modal.style.display = 'block';
            }

            showInstallInstructions(walletType) {
                const wallet = WALLET_CONFIG[walletType];
                const deviceType = this.deviceDetector.getDeviceType();
                
                let downloadUrl = '';
                if (this.deviceDetector.isIOS()) {
                    downloadUrl = wallet.downloadUrls.ios;
                } else if (this.deviceDetector.isAndroid()) {
                    downloadUrl = wallet.downloadUrls.android;
                }

                const instructions = `
                    –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ${wallet.name} –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ.
                    
                    –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:
                    1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ ${wallet.name} –∏–∑ App Store –∏–ª–∏ Google Play
                    2. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ —Å–æ–∑–¥–∞–π—Ç–µ –∫–æ—à–µ–ª–µ–∫
                    3. –í–µ—Ä–Ω–∏—Ç–µ—Å—å –Ω–∞ —ç—Ç–æ—Ç —Å–∞–π—Ç –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞
                    
                    ${downloadUrl ? `–°–∫–∞—á–∞—Ç—å: ${downloadUrl}` : ''}
                `;

                alert(instructions);
            }

            loadSettings() {
                const settings = localStorage.getItem('dapp-settings');
                if (settings) {
                    const parsed = JSON.parse(settings);
                    Object.assign(APP_CONFIG, parsed);
                    this.updateSettingsUI();
                }
            }

            saveSettings() {
                APP_CONFIG.autoRedirect = document.getElementById('auto-redirect').checked;
                APP_CONFIG.showInstructions = document.getElementById('show-instructions').checked;
                APP_CONFIG.debugMode = document.getElementById('debug-mode').checked;
                APP_CONFIG.preferredWallet = document.getElementById('preferred-wallet').value;

                localStorage.setItem('dapp-settings', JSON.stringify(APP_CONFIG));
                
                alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
                debug('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã', APP_CONFIG);
            }

            updateSettingsUI() {
                document.getElementById('auto-redirect').checked = APP_CONFIG.autoRedirect;
                document.getElementById('show-instructions').checked = APP_CONFIG.showInstructions;
                document.getElementById('debug-mode').checked = APP_CONFIG.debugMode;
                document.getElementById('preferred-wallet').value = APP_CONFIG.preferredWallet;
            }
        }

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function handleWalletConnection(walletType) {
            deepLinkRouter.connectWallet(walletType);
        }

        function testDeepLink() {
            const testUrl = `${APP_CONFIG.baseUrl}?wallet=phantom&action=connect`;
            debug(`–¢–µ—Å—Ç–∏—Ä—É–µ–º –¥–∏–ø–ª–∏–Ω–∫: ${testUrl}`);
            window.open(testUrl, '_blank');
        }

        function showDeviceInfo() {
            const info = {
                userAgent: navigator.userAgent,
                device: deepLinkRouter.deviceDetector.getDeviceType(),
                browser: deepLinkRouter.deviceDetector.getBrowser(),
                wallet: deepLinkRouter.deviceDetector.getWalletBrowser(),
                mobile: deepLinkRouter.deviceDetector.isMobile(),
                ios: deepLinkRouter.deviceDetector.isIOS(),
                android: deepLinkRouter.deviceDetector.isAndroid()
            };
            
            alert(JSON.stringify(info, null, 2));
        }

        function connectWallet() {
            deepLinkRouter.navigateToPage('wallet');
        }

        function checkBalance() {
            alert('–§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–∞–ª–∞–Ω—Å–∞ (–¥–µ–º–æ)');
        }

        function sendTransaction() {
            alert('–§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–¥–µ–º–æ)');
        }

        function viewNFTs() {
            alert('–§—É–Ω–∫—Ü–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ NFT (–¥–µ–º–æ)');
        }

        function saveSettings() {
            deepLinkRouter.saveSettings();
        }

        function resetSettings() {
            localStorage.removeItem('dapp-settings');
            location.reload();
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function toggleDebug() {
            const panel = document.getElementById('debug-panel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        function debug(message, data = null) {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}`;
            
            console.log(logMessage, data);
            
            if (APP_CONFIG.debugMode) {
                const debugContent = document.getElementById('debug-content');
                const logEntry = document.createElement('div');
                logEntry.textContent = logMessage;
                logEntry.style.marginBottom = '5px';
                logEntry.style.fontSize = '11px';
                
                debugContent.appendChild(logEntry);
                
                // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π
                while (debugContent.children.length > 20) {
                    debugContent.removeChild(debugContent.firstChild);
                }
                
                debugContent.scrollTop = debugContent.scrollHeight;
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        let deepLinkRouter;

        document.addEventListener('DOMContentLoaded', function() {
            debug('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Deep Link Router');
            deepLinkRouter = new DeepLinkRouter();
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }
    </script>
</body>
</html>
