<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Solana Wallet Router</title>
  <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
  <style>
    :root {
      --primary: #9945FF;
      --secondary: #14F195;
      --accent: #6E56CF;
      --background: #0D0D0D;
      --card-bg: #1A1A1A;
      --text: #FFFFFF;
      --text-secondary: #A0A0A0;
      --border: #333333;
      --success: #14F195;
      --error: #FF5252;
      --warning: #FFD600;
      --info: #2196F3;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    }
    
    body {
      background: linear-gradient(135deg, var(--background) 0%, #1a1a2e 100%);
      color: var(--text);
      min-height: 100vh;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    
    .container {
      width: 100%;
      max-width: 480px;
      margin: 0 auto;
    }
    
    .header {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .header h1 {
      font-size: 28px;
      margin-bottom: 8px;
      background: linear-gradient(to right, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .header p {
      color: var(--text-secondary);
      font-size: 16px;
    }
    
    .card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 20px;
      border: 1px solid var(--border);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(10px);
    }
    
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    
    .card-title {
      font-size: 18px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .icon {
      width: 20px;
      height: 20px;
    }
    
    .browser-info {
      background: rgba(33, 150, 243, 0.1);
      border: 1px solid rgba(33, 150, 243, 0.3);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 20px;
    }
    
    .browser-info-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      color: var(--info);
      font-weight: 600;
    }
    
    .safari-redirect {
      background: rgba(255, 214, 0, 0.1);
      border: 1px solid rgba(255, 214, 0, 0.3);
      color: var(--warning);
    }
    
    .wallet-browser-detected {
      background: rgba(20, 241, 149, 0.1);
      border: 1px solid rgba(20, 241, 149, 0.3);
      color: var(--secondary);
    }
    
    .wallet-list {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 16px;
    }
    
    .wallet-option {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    
    .wallet-option::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      transition: left 0.5s;
    }
    
    .wallet-option:hover::before {
      left: 100%;
    }
    
    .wallet-option:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(153, 69, 255, 0.3);
    }
    
    .wallet-option img {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      margin-bottom: 8px;
    }
    
    .wallet-option .name {
      font-weight: 500;
      margin-bottom: 4px;
    }
    
    .wallet-option .status {
      font-size: 12px;
      color: var(--success);
    }
    
    .wallet-option .browser-badge {
      position: absolute;
      top: 8px;
      right: 8px;
      background: var(--primary);
      color: white;
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: bold;
    }
    
    .recommended-wallets {
      margin-top: 20px;
    }
    
    .recommended-wallets h3 {
      margin-bottom: 12px;
      color: var(--secondary);
      font-size: 16px;
    }
    
    .wallet-download-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .wallet-download-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      text-decoration: none;
      color: var(--text);
      transition: all 0.2s ease;
    }
    
    .wallet-download-item:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: translateX(4px);
    }
    
    .wallet-download-item img {
      width: 32px;
      height: 32px;
      border-radius: 8px;
    }
    
    .wallet-download-info {
      flex: 1;
    }
    
    .wallet-download-info .name {
      font-weight: 500;
      margin-bottom: 2px;
    }
    
    .wallet-download-info .description {
      font-size: 12px;
      color: var(--text-secondary);
    }
    
    .download-icon {
      width: 16px;
      height: 16px;
      color: var(--text-secondary);
    }
    
    .button {
      background: linear-gradient(to right, var(--primary), var(--accent));
      color: white;
      border: none;
      border-radius: 12px;
      padding: 14px 24px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
      text-decoration: none;
    }
    
    .button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(153, 69, 255, 0.4);
    }
    
    .button.secondary {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid var(--border);
    }
    
    .button.warning {
      background: linear-gradient(to right, var(--warning), #ff9800);
      color: #000;
    }
    
    .button.success {
      background: linear-gradient(to right, var(--success), #00e676);
      color: #000;
    }
    
    .instruction-steps {
      margin-top: 20px;
    }
    
    .step {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
      align-items: flex-start;
    }
    
    .step-number {
      width: 28px;
      height: 28px;
      background: linear-gradient(to right, var(--primary), var(--accent));
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 14px;
      flex-shrink: 0;
    }
    
    .step-content h3 {
      margin-bottom: 4px;
      font-size: 16px;
    }
    
    .step-content p {
      color: var(--text-secondary);
      font-size: 14px;
      line-height: 1.4;
    }
    
    .wallet-info {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      padding: 12px;
      margin-top: 16px;
    }
    
    .wallet-info .label {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 4px;
    }
    
    .wallet-info .value {
      font-family: monospace;
      word-break: break-all;
      font-size: 14px;
      background: rgba(0, 0, 0, 0.3);
      padding: 8px;
      border-radius: 4px;
      margin-bottom: 12px;
    }
    
    .balance-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 16px;
    }
    
    .balance-amount {
      font-size: 24px;
      font-weight: bold;
    }
    
    .status-indicator {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 14px;
    }
    
    .status-indicator .dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }
    
    .status-indicator.online .dot {
      background-color: var(--success);
      box-shadow: 0 0 8px var(--success);
    }
    
    .hidden {
      display: none !important;
    }
    
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    
    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-top: 3px solid var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 16px;
    }
    
    .loading-text {
      color: white;
      font-size: 16px;
      text-align: center;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }
    
    @media (max-width: 480px) {
      .wallet-list {
        grid-template-columns: 1fr;
      }
      
      .card {
        padding: 16px;
      }
      
      .header h1 {
        font-size: 24px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Smart Wallet Router</h1>
      <p id="headerDescription">Умное подключение к Solana кошелькам</p>
    </div>
    
    <!-- Информация о браузере -->
    <div id="browserInfo" class="browser-info hidden">
      <div class="browser-info-header">
        <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"></circle>
          <path d="M12 6v6l4 2"></path>
        </svg>
        <span id="browserInfoTitle">Информация о браузере</span>
      </div>
      <p id="browserInfoText">Определяем ваш браузер...</p>
    </div>
    
    <!-- Карточка для Safari на мобильном -->
    <div id="safariCard" class="card hidden">
      <div class="card-header">
        <div class="card-title">
          <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect width="14" height="20" x="5" y="2" rx="2" ry="2"></rect>
            <path d="M12 18h.01"></path>
          </svg>
          Мобильный Safari
        </div>
      </div>
      
      <div class="browser-info safari-redirect">
        <div class="browser-info-header">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
            <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
          </svg>
          Рекомендуем использовать кошелек с браузером
        </div>
        <p>Для лучшего опыта используйте встроенный браузер кошелька. Выберите кошелек ниже:</p>
      </div>
      
      <div class="wallet-list">
        <div class="wallet-option" data-wallet="phantom" data-action="safari-redirect">
          <div class="browser-badge">DApp</div>
          <img src="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%20128%20128'%3E%3Cpath%20fill='%23AB9FF2'%20d='M0%200h128v128H0z'/%3E%3Cpath%20fill='%23FFFDF8'%20fill-rule='evenodd'%20d='M55.6%2082.1C51%2089.5%2043%2098.7%2032.3%2098.7c-5%200-9.9-2-9.9-11%200-23%2031.2-58.4%2060.2-58.4%2016.5%200%2023.1%2011.5%2023.1%2024.5%200%2016.6-10.8%2035.7-21.6%2035.7-3.4%200-5-1.9-5-4.8%200-.8%200-1.6.3-2.6-3.7%206.3-10.7%2012.1-17.4%2012.1-4.8%200-7.3-3-7.3-7.3%200-1.5.4-3.1%201-4.8Zm25-28.8c0%203.8-2.2%205.7-4.7%205.7-2.6%200-4.8-1.9-4.8-5.7%200-3.8%202.2-5.7%204.8-5.7%202.5%200%204.7%202%204.7%205.7Zm14.2%200c0%203.8-2.2%205.7-4.7%205.7-2.6%200-4.8-1.9-4.8-5.7%200-3.8%202.2-5.7%204.8-5.7%202.5%200%204.7%202%204.7%205.7Z'%20clip-rule='evenodd'/%3E%3C/svg%3E" alt="Phantom">
          <div class="name">Phantom</div>
          <div class="status">Открыть браузер</div>
        </div>
        <div class="wallet-option" data-wallet="solflare" data-action="safari-redirect">
          <div class="browser-badge">DApp</div>
          <img src="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%20350%20350'%3E%3Cpath%20id='a'%20fill='%23FFEF46'%20d='M0%200h350v350H0z'/%3E%3Cpath%20fill='%2302050A'%20d='m171%20183%2014-14%2026%209c18%206%2027%2017%2027%2032%200%2011-5%2019-13%2028l-3%203%201-7c4-24-4-35-28-43l-24-8Zm-36-84%2072%2024-15%2015-38-13c-13-4-18-11-19-26Zm-5%20123%2017-16%2031%2010c16%205%2022%2013%2020%2030l-68-24Zm-20-70c0-5%202-9%206-13%204%206%2012%2012%2024%2016l25%208-14%2014-25-8c-12-4-16-10-16-17Zm76%20127c53-36%2081-60%2081-89%200-20-11-31-37-39l-19-7%2053-51-11-11-16%2014-74-25c-23%208-52%2030-52%2052l1%207c-19%2011-27%2022-27%2034s6%2024%2026%2030l16%206-55%2053%2011%2011%2017-16%2086%2031Z'/%3E%3C/svg%3E" alt="Solflare">
          <div class="name">Solflare</div>
          <div class="status">Открыть браузер</div>
        </div>
        <div class="wallet-option" data-wallet="trustwallet" data-action="safari-redirect">
          <div class="browser-badge">DApp</div>
          <img src="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20500%20500'%20fill='white'%3E%3Cdefs%3E%3ClinearGradient%20id='a'%20x1='609.58'%20x2='500.46'%20y1='-1336.58'%20y2='-1679.92'%20gradientTransform='matrix(1%200%200%20-.98%20-255.4%20-1243.33)'%20gradientUnits='userSpaceOnUse'%3E%3Cstop%20offset='.02'%20stop-color='%2300f'%3E%3C/stop%3E%3Cstop%20offset='.08'%20stop-color='%230094ff'%3E%3C/stop%3E%3Cstop%20offset='.16'%20stop-color='%2348ff91'%3E%3C/stop%3E%3Cstop%20offset='.42'%20stop-color='%230094ff'%3E%3C/stop%3E%3Cstop%20offset='.68'%20stop-color='%230038ff'%3E%3C/stop%3E%3Cstop%20offset='.9'%20stop-color='%230500ff'%3E%3C/stop%3E%3C/linearGradient%3E%3C/defs%3E%3Cpath%20fill='%23fff'%20d='M0%200h500v500H0z'%3E%3C/path%3E%3Cpath%20fill='%230500ff'%20d='M105%20141.22%20250%2095v320c-103.57-42.67-145-124.45-145-170.66V141.22Z'%3E%3C/path%3E%3Cpath%20fill='url(%23a)'%20d='M395%20141.22%20250%2095v320c103.57-42.67%20145-124.45%20145-170.66V141.22Z'%3E%3C/path%3E%3C/svg%3E" alt="Trust Wallet">
          <div class="name">Trust Wallet</div>
          <div class="status">Открыть браузер</div>
        </div>
        <div class="wallet-option" data-wallet="safepal" data-action="safari-redirect">
          <div class="browser-badge">DApp</div>
          <img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20fill=%22none%22%20viewBox=%220%200%20260%20260%22%3E%3Cpath%20fill=%22%234A21EF%22%20d=%22M0%200h260v260H0z%22/%3E%3Cpath%20fill=%22%23fff%22%20d=%22M121%2057.5c-4.4%200-8.6%201.8-11.8%205l-49.4%2049.3a9.6%209.6%200%200%200%200%2013.6l32.4%2032.4v-57.4c0-4.2%203.4-7.7%207.7-7.7h68l35.3-35.2H121ZM92.2%20168.5h68c4.3%200%207.8-3.5%207.8-7.8v-57.3l32.4%2032.4a9.6%209.6%200%200%201%200%2013.6l-49.5%2049.4c-3.1%203.1-7.4%204.9-11.8%204.9H57l35.2-35.2Z%22/%3E%3C/svg%3E" alt="SafePal">
          <div class="name">SafePal</div>
          <div class="status">Открыть браузер</div>
        </div>
      </div>
    </div>
    
    <!-- Карточка для обычных браузеров -->
    <div id="regularBrowserCard" class="card hidden">
      <div class="card-header">
        <div class="card-title">
          <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="3"></circle>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
          </svg>
          Инструкция для подключения
        </div>
      </div>
      
      <div class="browser-info">
        <div class="browser-info-header">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
            <path d="M12 17h.01"></path>
          </svg>
          Для лучшего опыта
        </div>
        <p>Рекомендуем использовать встроенный браузер кошелька для безопасного подключения к DApp</p>
      </div>
      
      <div class="instruction-steps">
        <div class="step">
          <div class="step-number">1</div>
          <div class="step-content">
            <h3>Установите кошелек</h3>
            <p>Скачайте приложение кошелька с официального сайта или App Store/Google Play</p>
          </div>
        </div>
        <div class="step">
          <div class="step-number">2</div>
          <div class="step-content">
            <h3>Откройте браузер кошелька</h3>
            <p>В приложении кошелька найдите раздел "Browser" или "DApp Browser"</p>
          </div>
        </div>
        <div class="step">
          <div class="step-number">3</div>
          <div class="step-content">
            <h3>Перейдите на наш сайт</h3>
            <p>Введите адрес нашего сайта в браузере кошелька для автоматического подключения</p>
          </div>
        </div>
      </div>
      
      <div class="recommended-wallets">
        <h3>Рекомендуемые кошельки:</h3>
        <div class="wallet-download-list">
          <a href="https://phantom.app/" target="_blank" class="wallet-download-item">
            <img src="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%20128%20128'%3E%3Cpath%20fill='%23AB9FF2'%20d='M0%200h128v128H0z'/%3E%3Cpath%20fill='%23FFFDF8'%20fill-rule='evenodd'%20d='M55.6%2082.1C51%2089.5%2043%2098.7%2032.3%2098.7c-5%200-9.9-2-9.9-11%200-23%2031.2-58.4%2060.2-58.4%2016.5%200%2023.1%2011.5%2023.1%2024.5%200%2016.6-10.8%2035.7-21.6%2035.7-3.4%200-5-1.9-5-4.8%200-.8%200-1.6.3-2.6-3.7%206.3-10.7%2012.1-17.4%2012.1-4.8%200-7.3-3-7.3-7.3%200-1.5.4-3.1%201-4.8Zm25-28.8c0%203.8-2.2%205.7-4.7%205.7-2.6%200-4.8-1.9-4.8-5.7%200-3.8%202.2-5.7%204.8-5.7%202.5%200%204.7%202%204.7%205.7Zm14.2%200c0%203.8-2.2%205.7-4.7%205.7-2.6%200-4.8-1.9-4.8-5.7%200-3.8%202.2-5.7%204.8-5.7%202.5%200%204.7%202%204.7%205.7Z'%20clip-rule='evenodd'/%3E%3C/svg%3E" alt="Phantom">
            <div class="wallet-download-info">
              <div class="name">Phantom</div>
              <div class="description">Самый популярный кошелек Solana</div>
            </div>
            <svg class="download-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7 10 12 15 17 10"></polyline>
              <line x1="12" x2="12" y1="15" y2="3"></line>
            </svg>
          </a>
          <a href="https://solflare.com/" target="_blank" class="wallet-download-item">
            <img src="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%20350%20350'%3E%3Cpath%20id='a'%20fill='%23FFEF46'%20d='M0%200h350v350H0z'/%3E%3Cpath%20fill='%2302050A'%20d='m171%20183%2014-14%2026%209c18%206%2027%2017%2027%2032%200%2011-5%2019-13%2028l-3%203%201-7c4-24-4-35-28-43l-24-8Zm-36-84%2072%2024-15%2015-38-13c-13-4-18-11-19-26Zm-5%20123%2017-16%2031%2010c16%205%2022%2013%2020%2030l-68-24Zm-20-70c0-5%202-9%206-13%204%206%2012%2012%2024%2016l25%208-14%2014-25-8c-12-4-16-10-16-17Zm76%20127c53-36%2081-60%2081-89%200-20-11-31-37-39l-19-7%2053-51-11-11-16%2014-74-25c-23%208-52%2030-52%2052l1%207c-19%2011-27%2022-27%2034s6%2024%2026%2030l16%206-55%2053%2011%2011%2017-16%2086%2031Z'/%3E%3C/svg%3E" alt="Solflare">
            <div class="wallet-download-info">
              <div class="name">Solflare</div>
              <div class="description">Официальный кошелек экосистемы Solana</div>
            </div>
            <svg class="download-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7 10 12 15 17 10"></polyline>
              <line x1="12" x2="12" y1="15" y2="3"></line>
            </svg>
          </a>
          <a href="https://trustwallet.com/" target="_blank" class="wallet-download-item">
            <img src="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20500%20500'%20fill='white'%3E%3Cdefs%3E%3ClinearGradient%20id='a'%20x1='609.58'%20x2='500.46'%20y1='-1336.58'%20y2='-1679.92'%20gradientTransform='matrix(1%200%200%20-.98%20-255.4%20-1243.33)'%20gradientUnits='userSpaceOnUse'%3E%3Cstop%20offset='.02'%20stop-color='%2300f'%3E%3C/stop%3E%3Cstop%20offset='.08'%20stop-color='%230094ff'%3E%3C/stop%3E%3Cstop%20offset='.16'%20stop-color='%2348ff91'%3E%3C/stop%3E%3Cstop%20offset='.42'%20stop-color='%230094ff'%3E%3C/stop%3E%3Cstop%20offset='.68'%20stop-color='%230038ff'%3E%3C/stop%3E%3Cstop%20offset='.9'%20stop-color='%230500ff'%3E%3C/stop%3E%3C/linearGradient%3E%3C/defs%3E%3Cpath%20fill='%23fff'%20d='M0%200h500v500H0z'%3E%3C/path%3E%3Cpath%20fill='%230500ff'%20d='M105%20141.22%20250%2095v320c-103.57-42.67-145-124.45-145-170.66V141.22Z'%3E%3C/path%3E%3Cpath%20fill='url(%23a)'%20d='M395%20141.22%20250%2095v320c103.57-42.67%20145-124.45%20145-170.66V141.22Z'%3E%3C/path%3E%3C/svg%3E" alt="Trust Wallet">
            <div class="wallet-download-info">
              <div class="name">Trust Wallet</div>
              <div class="description">Мультивалютный кошелек</div>
            </div>
            <svg class="download-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7 10 12 15 17 10"></polyline>
              <line x1="12" x2="12" y1="15" y2="3"></line>
            </svg>
          </a>
          <a href="https://www.safepal.com/" target="_blank" class="wallet-download-item">
            <img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20fill=%22none%22%20viewBox=%220%200%20260%20260%22%3E%3Cpath%20fill=%22%234A21EF%22%20d=%22M0%200h260v260H0z%22/%3E%3Cpath%20fill=%22%23fff%22%20d=%22M121%2057.5c-4.4%200-8.6%201.8-11.8%205l-49.4%2049.3a9.6%209.6%200%200%200%200%2013.6l32.4%2032.4v-57.4c0-4.2%203.4-7.7%207.7-7.7h68l35.3-35.2H121ZM92.2%20168.5h68c4.3%200%207.8-3.5%207.8-7.8v-57.3l32.4%2032.4a9.6%209.6%200%200%201%200%2013.6l-49.5%2049.4c-3.1%203.1-7.4%204.9-11.8%204.9H57l35.2-35.2Z%22/%3E%3C/svg%3E" alt="SafePal">
            <div class="wallet-download-info">
              <div class="name">SafePal</div>
              <div class="description">Безопасный криптокошелек</div>
            </div>
            <svg class="download-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7 10 12 15 17 10"></polyline>
              <line x1="12" x2="12" y1="15" y2="3"></line>
            </svg>
          </a>
        </div>
      </div>
    </div>
    
    <!-- Карточка для браузера кошелька -->
    <div id="walletBrowserCard" class="card hidden">
      <div class="card-header">
        <div class="card-title">
          <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 12V7H5a2 2 0 0 1 0-4h14v4"></path>
            <path d="M3 5v14a2 2 0 0 0 2 2h16v-5"></path>
            <path d="M18 12a2 2 0 0 0 0 4h4v-4Z"></path>
          </svg>
          <span id="walletBrowserTitle">Кошелек обнаружен</span>
        </div>
        <div class="status-indicator online">
          <div class="dot"></div>
          <span>Готов</span>
        </div>
      </div>
      
      <div class="browser-info wallet-browser-detected">
        <div class="browser-info-header">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M9 12l2 2 4-4"></path>
            <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"></path>
            <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3"></path>
          </svg>
          <span id="detectedWalletName">Браузер кошелька</span>
        </div>
        <p>Отлично! Вы находитесь в браузере кошелька. Нажмите кнопку ниже для подключения.</p>
      </div>
      
      <button id="autoConnectBtn" class="button success">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M9 12l2 2 4-4"></path>
          <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"></path>
          <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3"></path>
        </svg>
        Подключить кошелек автоматически
      </button>
    </div>
    
    <!-- Карточка подключенного кошелька -->
    <div id="connectedWalletCard" class="card hidden">
      <div class="card-header">
        <div class="card-title">
          <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 12V7H5a2 2 0 0 1 0-4h14v4"></path>
            <path d="M3 5v14a2 2 0 0 0 2 2h16v-5"></path>
            <path d="M18 12a2 2 0 0 0 0 4h4v-4Z"></path>
          </svg>
          Кошелек подключен
        </div>
        <div class="status-indicator online">
          <div class="dot"></div>
          <span>Онлайн</span>
        </div>
      </div>
      
      <div class="wallet-info">
        <div class="label">Кошелек:</div>
        <div id="connectedWalletName" class="value">...</div>
        
        <div class="label">Адрес:</div>
        <div id="connectedWalletAddress" class="value">...</div>
      </div>
      
      <div class="balance-row">
        <div>
          <div class="label">Баланс SOL:</div>
          <div id="solBalance" class="balance-amount">0.0000</div>
        </div>
        
        <button id="refreshButton" class="button secondary small">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 2v6h-6"></path>
            <path d="M3 12a9 9 0 0 1 15-6.7L21 8"></path>
            <path d="M3 22v-6h6"></path>
            <path d="M21 12a9 9 0 0 1-15 6.7L3 16"></path>
          </svg>
        </button>
      </div>
      
      <button id="disconnectButton" class="button secondary" style="margin-top: 20px;">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
          <polyline points="16 17 21 12 16 7"></polyline>
          <line x1="21" x2="9" y1="12" y2="12"></line>
        </svg>
        Отключить кошелек
      </button>
    </div>
  </div>
  
  <!-- Оверлей загрузки -->
  <div id="loadingOverlay" class="loading-overlay hidden">
    <div class="loading-spinner"></div>
    <div id="loadingText" class="loading-text">Определяем браузер...</div>
  </div>

  <script>
    // Умный роутер для Solana кошельков
    class SmartWalletRouter {
      constructor() {
        this.connection = null;
        this.wallet = null;
        this.walletName = null;
        this.publicKey = null;
        
        // Конфигурация кошельков
        this.walletConfigs = {
          phantom: {
            name: 'Phantom',
            dappBrowserUrl: 'https://phantom.app/ul/browse/',
            userAgentCheck: ['phantom'],
            providerCheck: () => window.phantom?.solana?.isPhantom,
            getProvider: () => window.phantom?.solana
          },
          solflare: {
            name: 'Solflare',
            dappBrowserUrl: 'https://solflare.com/ul/v1/browse/',
            userAgentCheck: ['solflare'],
            providerCheck: () => window.solflare?.isSolflare,
            getProvider: () => window.solflare
          },
          trustwallet: {
            name: 'Trust Wallet',
            dappBrowserUrl: 'https://link.trustwallet.com/open_url?coin_id=501&url=',
            userAgentCheck: ['trust'],
            providerCheck: () => window.trustwallet?.solana,
            getProvider: () => window.trustwallet?.solana
          },
          safepal: {
            name: 'SafePal',
            dappBrowserUrl: 'https://www.safepal.com/download',
            userAgentCheck: ['safepal'],
            providerCheck: () => window.safepal?.solana,
            getProvider: () => window.safepal?.solana
          },
          coinbase: {
            name: 'Coinbase Wallet',
            dappBrowserUrl: 'https://go.cb-w.com/dapp?cb_url=',
            userAgentCheck: ['coinbase'],
            providerCheck: () => window.coinbaseSolana,
            getProvider: () => window.coinbaseSolana
          }
        };
        
        this.init();
      }
      
      // Инициализация
      init() {
        this.showLoading('Определяем браузер...');
        
        // Создаем подключение к Solana
        this.connection = new solanaWeb3.Connection(
          'https://api.mainnet-beta.solana.com',
          'confirmed'
        );
        
        // Определяем браузер и устройство
        setTimeout(() => {
          this.detectBrowserAndRoute();
        }, 1000);
      }
      
      // Определение браузера и маршрутизация
      detectBrowserAndRoute() {
        const userAgent = navigator.userAgent.toLowerCase();
        const isMobile = this.isMobileDevice();
        const isSafari = this.isSafariBrowser();
        const walletBrowser = this.detectWalletBrowser();
        
        console.log('Browser detection:', {
          userAgent,
          isMobile,
          isSafari,
          walletBrowser
        });
        
        this.hideLoading();
        
        // Показываем информацию о браузере
        this.showBrowserInfo(userAgent, isMobile, isSafari, walletBrowser);
        
        if (walletBrowser) {
          // Если мы в браузере кошелька - показываем автоподключение
          this.showWalletBrowserCard(walletBrowser);
        } else if (isMobile && isSafari) {
          // Если мобильный Safari - показываем редирект в кошельки
          this.showSafariCard();
        } else {
          // Обычный браузер - показываем инструкцию
          this.showRegularBrowserCard();
        }
        
        // Добавляем обработчики событий
        this.addEventListeners();
      }
      
      // Проверка мобильного устройства
      isMobileDevice() {
        return /android|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent) || 
               window.innerWidth < 768;
      }
      
      // Проверка Safari
      isSafariBrowser() {
        const userAgent = navigator.userAgent.toLowerCase();
        return /^((?!chrome|android).)*safari/i.test(userAgent) && 
               !userAgent.includes('chrome') && 
               !userAgent.includes('crios');
      }
      
      // Определение браузера кошелька
      detectWalletBrowser() {
        const userAgent = navigator.userAgent.toLowerCase();
        
        // Проверяем по User Agent
        for (const [key, config] of Object.entries(this.walletConfigs)) {
          for (const check of config.userAgentCheck) {
            if (userAgent.includes(check)) {
              return { wallet: key, name: config.name };
            }
          }
        }
        
        // Проверяем по наличию провайдеров
        for (const [key, config] of Object.entries(this.walletConfigs)) {
          if (config.providerCheck()) {
            return { wallet: key, name: config.name };
          }
        }
        
        return null;
      }
      
      // Показ информации о браузере
      showBrowserInfo(userAgent, isMobile, isSafari, walletBrowser) {
        const browserInfo = document.getElementById('browserInfo');
        const browserInfoTitle = document.getElementById('browserInfoTitle');
        const browserInfoText = document.getElementById('browserInfoText');
        
        let title = 'Информация о браузере';
        let text = '';
        let className = 'browser-info';
        
        if (walletBrowser) {
          title = `${walletBrowser.name} браузер обнаружен`;
          text = 'Отлично! Вы используете браузер кошелька. Можем подключиться автоматически.';
          className += ' wallet-browser-detected';
        } else if (isMobile && isSafari) {
          title = 'Safari на мобильном устройстве';
          text = 'Для лучшего опыта рекомендуем использовать браузер кошелька.';
          className += ' safari-redirect';
        } else {
          title = 'Обычный браузер';
          text = 'Для безопасного подключения рекомендуем использовать браузер кошелька.';
        }
        
        browserInfo.className = className;
        browserInfoTitle.textContent = title;
        browserInfoText.textContent = text;
        browserInfo.classList.remove('hidden');
      }
      
      // Показ карточки для Safari
      showSafariCard() {
        document.getElementById('safariCard').classList.remove('hidden');
      }
      
      // Показ карточки для обычного браузера
      showRegularBrowserCard() {
        document.getElementById('regularBrowserCard').classList.remove('hidden');
      }
      
      // Показ карточки для браузера кошелька
      showWalletBrowserCard(walletInfo) {
        const card = document.getElementById('walletBrowserCard');
        const title = document.getElementById('walletBrowserTitle');
        const detectedName = document.getElementById('detectedWalletName');
        
        title.textContent = `${walletInfo.name} обнаружен`;
        detectedName.textContent = `${walletInfo.name} браузер`;
        
        card.classList.remove('hidden');
        
        // Автоматически пытаемся подключиться через 3 секунды
        setTimeout(() => {
          this.connectWalletInBrowser(walletInfo.wallet);
        }, 3000);
      }
      
      // Добавление обработчиков событий
      addEventListeners() {
        // Обработчики для кнопок кошельков в Safari
        document.querySelectorAll('[data-action="safari-redirect"]').forEach(option => {
          option.addEventListener('click', () => {
            const walletKey = option.getAttribute('data-wallet');
            this.redirectToWalletBrowser(walletKey);
          });
        });
        
        // Обработчик автоподключения
        const autoConnectBtn = document.getElementById('autoConnectBtn');
        if (autoConnectBtn) {
          autoConnectBtn.addEventListener('click', () => {
            const walletBrowser = this.detectWalletBrowser();
            if (walletBrowser) {
              this.connectWalletInBrowser(walletBrowser.wallet);
            }
          });
        }
        
        // Обработчик отключения
        const disconnectBtn = document.getElementById('disconnectButton');
        if (disconnectBtn) {
          disconnectBtn.addEventListener('click', () => {
            this.disconnectWallet();
          });
        }
        
        // Обработчик обновления баланса
        const refreshBtn = document.getElementById('refreshButton');
        if (refreshBtn) {
          refreshBtn.addEventListener('click', () => {
            this.fetchBalance();
          });
        }
      }
      
      // Редирект в браузер кошелька
      redirectToWalletBrowser(walletKey) {
        const config = this.walletConfigs[walletKey];
        if (!config) return;
        
        this.showLoading(`Открываем ${config.name} браузер...`);
        
        const currentUrl = encodeURIComponent(window.location.href);
        const dappBrowserUrl = config.dappBrowserUrl + currentUrl;
        
        // Показываем сообщение пользователю
        setTimeout(() => {
          this.hideLoading();
          alert(`Сейчас откроется ${config.name} браузер. Если приложение не установлено, вы будете перенаправлены на страницу загрузки.`);
        }, 1000);
        
        // Открываем браузер кошелька
        setTimeout(() => {
          window.location.href = dappBrowserUrl;
        }, 2000);
      }
      
      // Подключение к кошельку в браузере кошелька
      async connectWalletInBrowser(walletKey) {
        const config = this.walletConfigs[walletKey];
        if (!config) return;
        
        this.showLoading(`Подключение к ${config.name}...`);
        
        try {
          const provider = config.getProvider();
          
          if (!provider) {
            throw new Error(`${config.name} провайдер не найден`);
          }
          
          // Подключаемся к кошельку
          let response;
          if (provider.connect) {
            response = await provider.connect();
          }
          
          // Получаем публичный ключ
          let publicKey;
          if (response && response.publicKey) {
            publicKey = response.publicKey.toString();
          } else if (provider.publicKey) {
            publicKey = provider.publicKey.toString();
          } else {
            throw new Error('Не удалось получить публичный ключ');
          }
          
          // Сохраняем информацию о подключении
          this.wallet = provider;
          this.walletName = config.name;
          this.publicKey = publicKey;
          
          localStorage.setItem('connectedWallet', walletKey);
          localStorage.setItem('walletAddress', publicKey);
          
          // Обновляем UI
          this.hideLoading();
          this.showConnectedWallet();
          this.fetchBalance();
          
          // Добавляем обработчики событий кошелька
          this.setupWalletEventListeners();
          
        } catch (error) {
          console.error('Ошибка подключения:', error);
          this.hideLoading();
          alert('Ошибка подключения: ' + error.message);
        }
      }
      
      // Настройка обработчиков событий кошелька
      setupWalletEventListeners() {
        if (this.wallet && this.wallet.on) {
          this.wallet.on('disconnect', () => {
            this.disconnectWallet();
          });
          
          if (this.wallet.on('accountChanged')) {
            this.wallet.on('accountChanged', (publicKey) => {
              if (publicKey) {
                this.publicKey = publicKey.toString();
                localStorage.setItem('walletAddress', this.publicKey);
                this.showConnectedWallet();
                this.fetchBalance();
              } else {
                this.disconnectWallet();
              }
            });
          }
        }
      }
      
      // Отключение кошелька
      disconnectWallet() {
        try {
          if (this.wallet && this.wallet.disconnect) {
            this.wallet.disconnect();
          }
        } catch (error) {
          console.error('Ошибка отключения:', error);
        }
        
        this.wallet = null;
        this.walletName = null;
        this.publicKey = null;
        
        localStorage.removeItem('connectedWallet');
        localStorage.removeItem('walletAddress');
        
        // Перезагружаем страницу для повторного определения браузера
        window.location.reload();
      }
      
      // Показ подключенного кошелька
      showConnectedWallet() {
        // Скрываем все остальные карточки
        document.querySelectorAll('.
        // Скрываем все остальные карточки
        document.querySelectorAll('.card').forEach(card => {
          card.classList.add('hidden');
        });
        
        // Показываем карточку подключенного кошелька
        const connectedCard = document.getElementById('connectedWalletCard');
        const walletNameElement = document.getElementById('connectedWalletName');
        const walletAddressElement = document.getElementById('connectedWalletAddress');
        
        walletNameElement.textContent = this.walletName;
        walletAddressElement.textContent = this.publicKey;
        
        connectedCard.classList.remove('hidden');
      }
      
      // Получение баланса
      async fetchBalance() {
        if (!this.publicKey || !this.connection) return;
        
        try {
          document.getElementById('solBalance').innerHTML = '<div class="loading-spinner"></div>';
          
          const balance = await this.connection.getBalance(new solanaWeb3.PublicKey(this.publicKey));
          const solBalance = balance / solanaWeb3.LAMPORTS_PER_SOL;
          
          document.getElementById('solBalance').textContent = solBalance.toFixed(4);
        } catch (error) {
          console.error('Ошибка получения баланса:', error);
          document.getElementById('solBalance').textContent = 'Ошибка';
        }
      }
      
      // Показ индикатора загрузки
      showLoading(message) {
        const loadingOverlay = document.getElementById('loadingOverlay');
        const loadingText = document.getElementById('loadingText');
        
        loadingText.textContent = message;
        loadingOverlay.classList.remove('hidden');
      }
      
      // Скрытие индикатора загрузки
      hideLoading() {
        document.getElementById('loadingOverlay').classList.add('hidden');
      }
    }
    
    // Инициализация при загрузке страницы
    document.addEventListener('DOMContentLoaded', () => {
      window.smartWalletRouter = new SmartWalletRouter();
    });
  </script>
</body>
</html>
