<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Wallet Detector dApp</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            text-align: center;
            max-width: 500px;
            width: 100%;
        }

        h1 {
            color: #333;
            margin-bottom: 20px;
            font-size: 28px;
        }

        .info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: left;
        }

        .info h3 {
            color: #495057;
            margin-bottom: 10px;
        }

        .info p {
            color: #6c757d;
            line-height: 1.5;
            margin: 5px 0;
        }

        .connect-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            margin: 20px 0;
        }

        .connect-btn:hover {
            transform: translateY(-2px);
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 400px;
            position: relative;
            animation: slideIn 0.3s;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            right: 20px;
            top: 15px;
        }

        .close:hover {
            color: #000;
        }

        .wallet-list {
            display: grid;
            gap: 15px;
            margin-top: 20px;
        }

        .wallet-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .wallet-item:hover {
            border-color: #667eea;
            background-color: #f8f9ff;
        }

        .wallet-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
        }

        .phantom { background: #ab9ff2; }
        .safepal { background: #1890ff; }
        .trust { background: #3375bb; }
        .coinbase { background: #0052ff; }
        .metamask { background: #f6851b; }

        .instruction-modal .modal-content {
            text-align: center;
        }

        .instruction-steps {
            text-align: left;
            margin: 20px 0;
        }

        .instruction-steps li {
            margin: 10px 0;
            padding-left: 10px;
        }

        .store-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }

        .store-button {
            padding: 10px 15px;
            border-radius: 8px;
            text-decoration: none;
            color: white;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
        }

        .app-store {
            background: #0066cc;
        }

        .play-store {
            background: #01875f;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @media (max-width: 480px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 24px;
            }
        }

        #debug-info {
            position: fixed;
            bottom: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            max-width: 300px;
            z-index: 9999;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîó Wallet Connector</h1>
        
        <div class="info">
            <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ:</h3>
            <p><strong>–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ:</strong> <span id="deviceInfo">–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è...</span></p>
            <p><strong>–ë—Ä–∞—É–∑–µ—Ä:</strong> <span id="browserInfo">–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è...</span></p>
            <p><strong>–ö–æ—à–µ–ª—ë–∫:</strong> <span id="walletInfo">–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è...</span></p>
        </div>

        <button class="connect-btn" onclick="handleWalletConnection()">
            –ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫–æ—à–µ–ª—ë–∫
        </button>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ –∫–æ—à–µ–ª—å–∫–æ–≤ -->
    <div id="walletModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('walletModal')">&times;</span>
            <h2>–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ—à–µ–ª—ë–∫</h2>
            <div class="wallet-list">
                <div class="wallet-item" onclick="connectWallet('phantom')">
                    <div class="wallet-icon phantom">P</div>
                    <div>
                        <strong>Phantom</strong>
                        <div style="font-size: 12px; color: #666;">Solana –∫–æ—à–µ–ª—ë–∫</div>
                    </div>
                </div>
                <div class="wallet-item" onclick="connectWallet('safepal')">
                    <div class="wallet-icon safepal">S</div>
                    <div>
                        <strong>SafePal</strong>
                        <div style="font-size: 12px; color: #666;">–ú—É–ª—å—Ç–∏-–±–ª–æ–∫—á–µ–π–Ω –∫–æ—à–µ–ª—ë–∫</div>
                    </div>
                </div>
                <div class="wallet-item" onclick="connectWallet('trust')">
                    <div class="wallet-icon trust">T</div>
                    <div>
                        <strong>Trust Wallet</strong>
                        <div style="font-size: 12px; color: #666;">–ú–æ–±–∏–ª—å–Ω—ã–π –∫–æ—à–µ–ª—ë–∫</div>
                    </div>
                </div>
                <div class="wallet-item" onclick="connectWallet('coinbase')">
                    <div class="wallet-icon coinbase">C</div>
                    <div>
                        <strong>Coinbase Wallet</strong>
                        <div style="font-size: 12px; color: #666;">–°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π –∫–æ—à–µ–ª—ë–∫</div>
                    </div>
                </div>
                <div class="wallet-item" onclick="connectWallet('metamask')">
                    <div class="wallet-icon metamask">M</div>
                    <div>
                        <strong>MetaMask</strong>
                        <div style="font-size: 12px; color: #666;">Ethereum –∫–æ—à–µ–ª—ë–∫</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ -->
    <div id="instructionModal" class="modal instruction-modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('instructionModal')">&times;</span>
            <h2>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é</h2>
            <p>–î–∏–ø–ª–∏–Ω–∫ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:</p>
            <ol class="instruction-steps">
                <li>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞ –∏–∑ App Store –∏–ª–∏ Google Play</li>
                <li>–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞</li>
                <li>–ù–∞–π–¥–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é "Browser" –∏–ª–∏ "DApp Browser"</li>
                <li>–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –Ω–∞—à–µ–≥–æ —Å–∞–π—Ç–∞: <strong>https://heronwaterwow.github.io/bookish-waffle/</strong></li>
                <li>–ü–æ–¥–∫–ª—é—á–∏—Ç–µ –∫–æ—à–µ–ª—ë–∫ –Ω–∞ –Ω–∞—à–µ–º —Å–∞–π—Ç–µ</li>
            </ol>
            
            <div id="store-buttons" class="store-buttons">
                <!-- –ö–Ω–æ–ø–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
            
            <button class="connect-btn" id="try-again-btn">
                –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
            </button>
        </div>
    </div>

    <!-- –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
    <div id="debug-info"></div>

    <script>
        // –í–∫–ª—é—á–∏—Ç—å –æ—Ç–ª–∞–¥–∫—É (true/false)
        const DEBUG_MODE = true;
        
        // –¶–µ–ª–µ–≤–æ–π URL –¥–ª—è –¥–∏–ø–ª–∏–Ω–∫–æ–≤
        const TARGET_URL = 'https://heronwaterwow.github.io/bookish-waffle/';
        
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ—à–µ–ª—å–∫–æ–≤
        const WALLET_CONFIG = {
            phantom: {
                name: "Phantom",
                // –ù–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –¥–∏–ø–ª–∏–Ω–∫–æ–≤ –¥–ª—è Phantom
                deepLinks: [
                    `phantom://open?url=${encodeURIComponent(TARGET_URL)}`,
                    `https://phantom.app/ul/browse/${encodeURIComponent(TARGET_URL)}`,
                    `https://phantom.app/ul/v1/browse?url=${encodeURIComponent(TARGET_URL)}`
                ],
                userAgentPattern: /phantom/i,
                downloadUrls: {
                    ios: "https://apps.apple.com/app/phantom-solana-wallet/id1598432977",
                    android: "https://play.google.com/store/apps/details?id=app.phantom"
                }
            },
            safepal: {
                name: "SafePal",
                deepLinks: [
                    `safepal://open?url=${encodeURIComponent(TARGET_URL)}`,
                    `https://link.safepal.io/dapp?url=${encodeURIComponent(TARGET_URL)}`
                ],
                userAgentPattern: /safepal/i,
                downloadUrls: {
                    ios: "https://apps.apple.com/app/safepal-wallet/id1548297139",
                    android: "https://play.google.com/store/apps/details?id=io.safepal.wallet"
                }
            },
            trust: {
                name: "Trust Wallet",
                deepLinks: [
                    `trust://open_url?url=${encodeURIComponent(TARGET_URL)}`,
                    `https://link.trustwallet.com/open_url?url=${encodeURIComponent(TARGET_URL)}`,
                    `https://link.trustwallet.com/dapp?url=${encodeURIComponent(TARGET_URL)}`
                ],
                userAgentPattern: /trust/i,
                downloadUrls: {
                    ios: "https://apps.apple.com/app/trust-crypto-bitcoin-wallet/id1288339409",
                    android: "https://play.google.com/store/apps/details?id=com.wallet.crypto.trustapp"
                }
            },
            coinbase: {
                name: "Coinbase Wallet",
                deepLinks: [
                    `cbwallet://open_url?url=${encodeURIComponent(TARGET_URL)}`,
                    `https://go.cb-w.com/dapp?cb_url=${encodeURIComponent(TARGET_URL)}`
                ],
                userAgentPattern: /coinbasewallet|coinbase/i,
                downloadUrls: {
                    ios: "https://apps.apple.com/app/coinbase-wallet-nfts-crypto/id1278383455",
                    android: "https://play.google.com/store/apps/details?id=org.toshi"
                }
            },
            metamask: {
                name: "MetaMask",
                deepLinks: [
                    `metamask://open?url=${encodeURIComponent(TARGET_URL)}`,
                    `https://metamask.app.link/dapp/${encodeURIComponent(TARGET_URL.replace('https://', ''))}`
                ],
                userAgentPattern: /metamask/i,
                downloadUrls: {
                    ios: "https://apps.apple.com/app/metamask/id1438144202",
                    android: "https://play.google.com/store/apps/details?id=io.metamask"
                }
            }
        };

        // –ö–ª–∞—Å—Å –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏ –±—Ä–∞—É–∑–µ—Ä–∞
        class DeviceDetector {
            constructor() {
                this.userAgent = navigator.userAgent.toLowerCase();
            }

            // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–æ–±–∏–ª—å–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
            isMobile() {
                return /android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(this.userAgent);
            }

            // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ iOS
            isIOS() {
                return /iphone|ipad|ipod/i.test(this.userAgent);
            }

            // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ Android
            isAndroid() {
                return /android/i.test(this.userAgent);
            }

            // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ Safari
            isSafari() {
                return /safari/i.test(this.userAgent) && !/chrome|chromium|edg/i.test(this.userAgent);
            }

            // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ Chrome
            isChrome() {
                return /chrome/i.test(this.userAgent) && !/edg/i.test(this.userAgent);
            }

            // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–æ–≤–æ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞
            getWalletBrowser() {
                // Phantom
                if (window.phantom?.solana || /phantom/i.test(this.userAgent)) {
                    return 'phantom';
                }
                
                // SafePal
                if (window.safepal || /safepal/i.test(this.userAgent)) {
                    return 'safepal';
                }
                
                // Trust Wallet
                if (window.trustwallet || /trust/i.test(this.userAgent)) {
                    return 'trust';
                }
                
                // Coinbase Wallet
                if (window.coinbaseWalletExtension || /coinbase/i.test(this.userAgent)) {
                    return 'coinbase';
                }
                
                // MetaMask Mobile
                if (window.ethereum?.isMetaMask || /metamask/i.test(this.userAgent)) {
                    return 'metamask';
                }
                
                return null;
            }

            // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –±—Ä–∞—É–∑–µ—Ä–µ
            getBrowserInfo() {
                if (this.isSafari()) return 'Safari';
                if (this.isChrome()) return 'Chrome';
                if (/firefox/i.test(this.userAgent)) return 'Firefox';
                if (/edg/i.test(this.userAgent)) return 'Edge';
                if (/yabrowser/i.test(this.userAgent)) return '–Ø–Ω–¥–µ–∫—Å.–ë—Ä–∞—É–∑–µ—Ä';
                if (/opera/i.test(this.userAgent)) return 'Opera';
                return '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä';
            }

            // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
            getDeviceInfo() {
                if (this.isIOS()) return 'iOS';
                if (this.isAndroid()) return 'Android';
                if (this.isMobile()) return '–ú–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ';
                return '–î–µ—Å–∫—Ç–æ–ø';
            }
        }

        // –ö–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∏–ø–ª–∏–Ω–∫–∞–º–∏
        class DeepLinkHandler {
            constructor() {
                this.currentWallet = null;
                this.timeoutId = null;
                this.isRedirecting = false;
            }

            // –û—Ç–∫—Ä—ã—Ç–∏–µ –¥–∏–ø–ª–∏–Ω–∫–∞ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
            openDeepLink(walletType) {
                const wallet = WALLET_CONFIG[walletType];
                if (!wallet) {
                    debug(`–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø –∫–æ—à–µ–ª—å–∫–∞: ${walletType}`);
                    return;
                }

                this.currentWallet = walletType;
                this.isRedirecting = true;

                debug(`–û—Ç–∫—Ä—ã–≤–∞–µ–º –¥–∏–ø–ª–∏–Ω–∫ –¥–ª—è ${wallet.name}`);

                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–∞—É—Ç –¥–ª—è –ø–æ–∫–∞–∑–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π
                this.timeoutId = setTimeout(() => {
                    debug(`–¢–∞–π–º–∞—É—Ç –¥–∏–ø–ª–∏–Ω–∫–∞ –¥–ª—è ${wallet.name}, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏`);
                    this.showInstructionModal(walletType);
                }, 2500);

                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞
                const handleVisibilityChange = () => {
                    if (document.hidden) {
                        debug("–°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–∫—Ä—ã—Ç–∞, –¥–∏–ø–ª–∏–Ω–∫ —Å—Ä–∞–±–æ—Ç–∞–ª");
                        clearTimeout(this.timeoutId);
                        document.removeEventListener("visibilitychange", handleVisibilityChange);
                        this.isRedirecting = false;
                    }
                };

                document.addEventListener("visibilitychange", handleVisibilityChange);

                // –ü—Ä–æ–±—É–µ–º –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–∏–ø–ª–∏–Ω–∫–æ–≤
                this.tryAllDeepLinks(wallet.deepLinks);
            }

            // –ü—Ä–æ–±—É–µ–º –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–∏–ø–ª–∏–Ω–∫–æ–≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
            tryAllDeepLinks(deepLinks) {
                if (!deepLinks || deepLinks.length === 0) {
                    debug("–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–∏–ø–ª–∏–Ω–∫–æ–≤");
                    return;
                }

                // –ú–µ—Ç–æ–¥ 1: window.location
                try {
                    debug(`–ü—Ä–æ–±—É–µ–º –º–µ—Ç–æ–¥ window.location: ${deepLinks[0]}`);
                    window.location.href = deepLinks[0];
                } catch (e) {
                    debug(`–û—à–∏–±–∫–∞ –º–µ—Ç–æ–¥–∞ window.location: ${e.message}`);
                }

                // –ú–µ—Ç–æ–¥ 2: window.open
                setTimeout(() => {
                    if (this.isRedirecting) {
                        try {
                            debug(`–ü—Ä–æ–±—É–µ–º –º–µ—Ç–æ–¥ window.open: ${deepLinks[0]}`);
                            window.open(deepLinks[0], '_self');
                        } catch (e) {
                            debug(`–û—à–∏–±–∫–∞ –º–µ—Ç–æ–¥–∞ window.open: ${e.message}`);
                        }
                    }
                }, 500);

                // –ú–µ—Ç–æ–¥ 3: —Å–æ–∑–¥–∞–Ω–∏–µ –∏ –∫–ª–∏–∫ –ø–æ —Å—Å—ã–ª–∫–µ
                setTimeout(() => {
                    if (this.isRedirecting) {
                        try {
                            debug(`–ü—Ä–æ–±—É–µ–º –º–µ—Ç–æ–¥ a.click(): ${deepLinks[0]}`);
                            const a = document.createElement('a');
                            a.href = deepLinks[0];
                            a.style.display = 'none';
                            document.body.appendChild(a);
                            a.click();
                            document.body.removeChild(a);
                        } catch (e) {
                            debug(`–û—à–∏–±–∫–∞ –º–µ—Ç–æ–¥–∞ a.click(): ${e.message}`);
                        }
                    }
                }, 1000);

                // –ú–µ—Ç–æ–¥ 4: iframe (–¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤)
                setTimeout(() => {
                    if (this.isRedirecting) {
                        try {
                            debug(`–ü—Ä–æ–±—É–µ–º –º–µ—Ç–æ–¥ iframe: ${deepLinks[0]}`);
                            const iframe = document.createElement('iframe');
                            iframe.style.display = 'none';
                            iframe.src = deepLinks[0];
                            document.body.appendChild(iframe);
                            setTimeout(() => {
                                document.body.removeChild(iframe);
                            }, 500);
                        } catch (e) {
                            debug(`–û—à–∏–±–∫–∞ –º–µ—Ç–æ–¥–∞ iframe: ${e.message}`);
                        }
                    }
                }, 1500);

                // –ï—Å–ª–∏ –µ—Å—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –¥–∏–ø–ª–∏–Ω–∫–∏, –ø—Ä–æ–±—É–µ–º –∏—Ö
                if (deepLinks.length > 1) {
                    setTimeout(() => {
                        if (this.isRedirecting) {
                            debug(`–ü—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –¥–∏–ø–ª–∏–Ω–∫: ${deepLinks[1]}`);
                            window.location.href = deepLinks[1];
                        }
                    }, 2000);
                }
            }

            // –ü–æ–∫–∞–∑ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏
            showInstructionModal(walletType) {
                this.isRedirecting = false;
                clearTimeout(this.timeoutId);
                
                const wallet = WALLET_CONFIG[walletType];
                if (!wallet) return;
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
                const storeButtons = document.getElementById('store-buttons');
                storeButtons.innerHTML = '';
                
                const deviceDetector = new DeviceDetector();
                
                if (deviceDetector.isIOS()) {
                    const appStoreBtn = document.createElement('a');
                    appStoreBtn.href = wallet.downloadUrls.ios;
                    appStoreBtn.target = '_blank';
                    appStoreBtn.className = 'store-button app-store';
                    appStoreBtn.textContent = `–°–∫–∞—á–∞—Ç—å ${wallet.name} –≤ App Store`;
                    storeButtons.appendChild(appStoreBtn);
                } else if (deviceDetector.isAndroid()) {
                    const playStoreBtn = document.createElement('a');
                    playStoreBtn.href = wallet.downloadUrls.android;
                    playStoreBtn.target = '_blank';
                    playStoreBtn.className = 'store-button play-store';
                    playStoreBtn.textContent = `–°–∫–∞—á–∞—Ç—å ${wallet.name} –≤ Google Play`;
                    storeButtons.appendChild(playStoreBtn);
                } else {
                    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞
                    const appStoreBtn = document.createElement('a');
                    appStoreBtn.href = wallet.downloadUrls.ios;
                    appStoreBtn.target = '_blank';
                    appStoreBtn.className = 'store-button app-store';
                    appStoreBtn.textContent = 'App Store';
                    storeButtons.appendChild(appStoreBtn);
                    
                    const playStoreBtn = document.createElement('a');
                    playStoreBtn.href = wallet.downloadUrls.android;
                    playStoreBtn.target = '_blank';
                    playStoreBtn.className = 'store-button play-store';
                    playStoreBtn.textContent = 'Google Play';
                    storeButtons.appendChild(playStoreBtn);
                }
                
                // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞"
                const tryAgainBtn = document.getElementById('try-again-btn');
                tryAgainBtn.onclick = () => {
                    closeModal('instructionModal');
                    this.openDeepLink(walletType);
                };
                
                showModal('instructionModal');
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–µ—Ç–µ–∫—Ç–æ—Ä–æ–≤
        const deviceDetector = new DeviceDetector();
        const deepLinkHandler = new DeepLinkHandler();

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        function updateDeviceInfo() {
            document.getElementById('deviceInfo').textContent = deviceDetector.getDeviceInfo();
            document.getElementById('browserInfo').textContent = deviceDetector.getBrowserInfo();
            
            const walletBrowser = deviceDetector.getWalletBrowser();
            document.getElementById('walletInfo').textContent = walletBrowser ? 
                `${walletBrowser.charAt(0).toUpperCase() + walletBrowser.slice(1)} –±—Ä–∞—É–∑–µ—Ä` : 
                '–û–±—ã—á–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä';
        }

        // –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞
        function handleWalletConnection() {
            debug('–ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞...');
            
            const isMobile = deviceDetector.isMobile();
            const walletBrowser = deviceDetector.getWalletBrowser();
            
            debug('–ú–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: ' + isMobile);
            debug('–ö–æ—à–µ–ª—ë–∫ –±—Ä–∞—É–∑–µ—Ä: ' + walletBrowser);

            // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –º–æ–±–∏–ª—å–Ω–æ–º –±—Ä–∞—É–∑–µ—Ä–µ –∫–æ—à–µ–ª—å–∫–∞
            if (isMobile && walletBrowser) {
                debug('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –º–æ–±–∏–ª—å–Ω–æ–º –±—Ä–∞—É–∑–µ—Ä–µ –∫–æ—à–µ–ª—å–∫–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ');
                showWalletModal();
                return;
            }

            // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ, –Ω–æ –Ω–µ –≤ –∫–æ—à–µ–ª—å–∫–æ–≤–æ–º –±—Ä–∞—É–∑–µ—Ä–µ
            if (isMobile && !walletBrowser) {
                debug('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ, –Ω–æ –Ω–µ –≤ –∫–æ—à–µ–ª—å–∫–æ–≤–æ–º –±—Ä–∞—É–∑–µ—Ä–µ');
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ—à–µ–ª—ë–∫ –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
                const preferredWallet = deviceDetector.isIOS() ? 'phantom' : 'trust';
                debug('–ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞: ' + preferredWallet);
                
                deepLinkHandler.openDeepLink(preferredWallet);
                return;
            }

            // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ
            if (!isMobile) {
                debug('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ');
                showWalletModal();
                return;
            }
        }

        // –ü–æ–∫–∞–∑ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å –∫–æ—à–µ–ª—å–∫–∞–º–∏
        function showWalletModal() {
            debug('–ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –≤—ã–±–æ—Ä–æ–º –∫–æ—à–µ–ª—å–∫–æ–≤');
            showModal('walletModal');
        }

        // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–æ—à–µ–ª—å–∫–∞
        function connectWallet(walletType) {
            debug('–ü–æ–¥–∫–ª—é—á–∞–µ–º –∫–æ—à–µ–ª—ë–∫: ' + walletType);
            
            const isMobile = deviceDetector.isMobile();
            const walletBrowser = deviceDetector.getWalletBrowser();

            // –ï—Å–ª–∏ –º—ã –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∫–æ—à–µ–ª—å–∫–∞, –ø—ã—Ç–∞–µ–º—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞–ø—Ä—è–º—É—é
            if (walletBrowser === walletType) {
                debug('–ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ –∫–æ—à–µ–ª—å–∫—É –Ω–∞–ø—Ä—è–º—É—é');
                connectWalletDirectly(walletType);
            } 
            // –ï—Å–ª–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ, –æ—Ç–∫—Ä—ã–≤–∞–µ–º –¥–∏–ø–ª–∏–Ω–∫
            else if (isMobile) {
                debug('–û—Ç–∫—Ä—ã–≤–∞–µ–º –¥–∏–ø–ª–∏–Ω–∫ –¥–ª—è –∫–æ—à–µ–ª—å–∫–∞: ' + walletType);
                closeModal('walletModal');
                deepLinkHandler.openDeepLink(walletType);
            }
            // –ù–∞ –¥–µ—Å–∫—Ç–æ–ø–µ –ø—ã—Ç–∞–µ–º—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
            else {
                debug('–ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è —á–µ—Ä–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞');
                connectWalletDirectly(walletType);
            }
        }

        // –ü—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∫–æ—à–µ–ª—å–∫—É
        async function connectWalletDirectly(walletType) {
            try {
                let provider = null;

                switch (walletType) {
                    case 'phantom':
                        provider = window.phantom?.solana;
                        break;
                    case 'metamask':
                        provider = window.ethereum?.isMetaMask ? window.ethereum : null;
                        break;
                    case 'coinbase':
                        provider = window.coinbaseWalletExtension;
                        break;
                    case 'trust':
                        provider = window.trustwallet;
                        break;
                    case 'safepal':
                        provider = window.safepal;
                        break;
                }

                if (provider) {
                    debug(`–ö–æ—à–µ–ª—ë–∫ ${walletType} –Ω–∞–π–¥–µ–Ω, –ø–æ–¥–∫–ª—é—á–∞–µ–º—Å—è...`);
                    
                    // –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ª–æ–≥–∏–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –∫–æ—à–µ–ª—å–∫—É
                    // –î–ª—è –ø—Ä–∏–º–µ—Ä–∞ –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                    alert(`–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ ${walletType} —É—Å–ø–µ—à–Ω–æ!`);
                    closeModal('walletModal');
                } else {
                    debug(`–ö–æ—à–µ–ª—ë–∫ ${walletType} –Ω–µ –Ω–∞–π–¥–µ–Ω`);
                    alert(`–ö–æ—à–µ–ª—ë–∫ ${walletType} –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω`);
                }
            } catch (error) {
                debug('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞: ' + error.message);
                alert('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞');
            }
        }

        // –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–æ–¥–∞–ª—å–Ω—ã–º–∏ –æ–∫–Ω–∞–º–∏
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        function debug(message) {
            console.log(message);
            
            if (DEBUG_MODE) {
                const debugInfo = document.getElementById('debug-info');
                debugInfo.style.display = 'block';
                
                const timestamp = new Date().toLocaleTimeString();
                const logEntry = document.createElement('div');
                logEntry.textContent = `[${timestamp}] ${message}`;
                
                debugInfo.appendChild(logEntry);
                
                // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π
                while (debugInfo.children.length > 10) {
                    debugInfo.removeChild(debugInfo.firstChild);
                }
                
                // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑
                debugInfo.scrollTop = debugInfo.scrollHeight;
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            debug('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–µ—Ç–µ–∫—Ç–æ—Ä —É—Å—Ç—Ä–æ–π—Å—Ç–≤');
            updateDeviceInfo();
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
            debug(`–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: ${deviceDetector.getDeviceInfo()}`);
            debug(`–ë—Ä–∞—É–∑–µ—Ä: ${deviceDetector.getBrowserInfo()}`);
            debug(`–ö–æ—à–µ–ª—ë–∫: ${deviceDetector.getWalletBrowser() || '–ù–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω'}`);
            debug(`User Agent: ${navigator.userAgent}`);
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
        window.addEventListener('orientationchange', function() {
            setTimeout(updateDeviceInfo, 500);
        });
    </script>
</body>
</html>
