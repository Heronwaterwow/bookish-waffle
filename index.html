<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phantom Wallet + WalletConnect</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ab9ff2, #667eea);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .wallet-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
        }

        .connection-methods {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .method-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.2s;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .method-card:hover {
            transform: translateY(-5px);
            border-color: #ab9ff2;
        }

        .method-card.active {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .method-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .method-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ab9ff2, #667eea);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            margin-right: 15px;
            font-size: 20px;
        }

        .btn {
            background: linear-gradient(45deg, #ab9ff2, #667eea);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            margin: 5px;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-danger {
            background: #dc3545;
        }

        .status {
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-weight: 500;
        }

        .status.disconnected {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }

        .status.connecting {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }

        .status.connected {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .status.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .wallet-info {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #ab9ff2;
        }

        .qr-code {
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: 10px;
            margin: 20px 0;
        }

        .qr-code canvas {
            border: 1px solid #ddd;
            border-radius: 10px;
        }

        .deep-link-section {
            background: #e3f2fd;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .deep-link-url {
            background: #f1f3f4;
            padding: 10px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            word-break: break-all;
            margin: 10px 0;
            border-left: 3px solid #ab9ff2;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #ab9ff2;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            position: relative;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            right: 20px;
            top: 15px;
        }

        .close:hover {
            color: #000;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .content {
                padding: 20px;
            }

            .connection-methods {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üëª Phantom + WalletConnect</h1>
            <p>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Phantom –∫–æ—à–µ–ª—å–∫–∞ —á–µ—Ä–µ–∑ WalletConnect –ø—Ä–æ—Ç–æ–∫–æ–ª</p>
        </div>

        <!-- Connection Status -->
        <div class="content">
            <h2>–°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</h2>
            <div id="connection-status" class="status disconnected">
                üî¥ –ö–æ—à–µ–ª–µ–∫ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω
            </div>
            
            <div id="wallet-info" class="wallet-info" style="display: none;">
                <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ—à–µ–ª—å–∫–µ</h3>
                <p><strong>–ê–¥—Ä–µ—Å:</strong> <span id="wallet-address">-</span></p>
                <p><strong>–ë–∞–ª–∞–Ω—Å:</strong> <span id="wallet-balance">-</span> SOL</p>
                <p><strong>–°–µ—Ç—å:</strong> <span id="wallet-network">-</span></p>
            </div>
        </div>

        <!-- Connection Methods -->
        <div class="content">
            <h2>–ú–µ—Ç–æ–¥—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</h2>
            
            <div class="connection-methods">
                <!-- WalletConnect Method -->
                <div class="method-card" id="walletconnect-card">
                    <div class="method-header">
                        <div class="method-icon">üîó</div>
                        <div>
                            <h3>WalletConnect</h3>
                            <p>–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</p>
                        </div>
                    </div>
                    <p>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ QR-–∫–æ–¥ –∏–ª–∏ deep link</p>
                    <button class="btn" onclick="connectWalletConnect()">
                        <span id="wc-btn-text">–ü–æ–¥–∫–ª—é—á–∏—Ç—å WalletConnect</span>
                        <span id="wc-loading" class="loading" style="display: none;"></span>
                    </button>
                    <button class="btn btn-secondary" onclick="disconnectWalletConnect()" style="display: none;" id="wc-disconnect-btn">
                        –û—Ç–∫–ª—é—á–∏—Ç—å
                    </button>
                </div>

                <!-- Direct Phantom Method -->
                <div class="method-card" id="phantom-card">
                    <div class="method-header">
                        <div class="method-icon">üëª</div>
                        <div>
                            <h3>–ü—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</h3>
                            <p>–ï—Å–ª–∏ Phantom —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω</p>
                        </div>
                    </div>
                    <p>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ window.phantom API</p>
                    <button class="btn" onclick="connectPhantomDirect()">
                        <span id="phantom-btn-text">–ü–æ–¥–∫–ª—é—á–∏—Ç—å Phantom</span>
                        <span id="phantom-loading" class="loading" style="display: none;"></span>
                    </button>
                    <button class="btn btn-secondary" onclick="disconnectPhantom()" style="display: none;" id="phantom-disconnect-btn">
                        –û—Ç–∫–ª—é—á–∏—Ç—å
                    </button>
                </div>

                <!-- Deep Link Method -->
                <div class="method-card" id="deeplink-card">
                    <div class="method-header">
                        <div class="method-icon">üì±</div>
                        <div>
                            <h3>Deep Links</h3>
                            <p>–î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤</p>
                        </div>
                    </div>
                    <p>–û—Ç–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ —Å—Ö–µ–º—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π</p>
                    <button class="btn" onclick="openPhantomDeepLink()">–û—Ç–∫—Ä—ã—Ç—å Phantom</button>
                    <button class="btn btn-secondary" onclick="openPhantomBrowser()">Phantom Browser</button>
                </div>
            </div>
        </div>

        <!-- QR Code Section -->
        <div class="content" id="qr-section" style="display: none;">
            <h2>QR-–∫–æ–¥ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</h2>
            <div class="qr-code">
                <div id="qr-code-container">
                    <!-- QR –∫–æ–¥ –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∑–¥–µ—Å—å -->
                </div>
                <p>–û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥ –≤ –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ Phantom</p>
            </div>
        </div>

        <!-- Deep Links Section -->
        <div class="content">
            <h2>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Deep Links</h2>
            
            <div class="deep-link-section">
                <h3>üîó –î–æ—Å—Ç—É–ø–Ω—ã–µ deep links</h3>
                
                <div style="margin: 15px 0;">
                    <h4>Phantom —Å—Ö–µ–º–∞:</h4>
                    <div class="deep-link-url" id="phantom-deeplink">
                        phantom://open?url=https://v0-mobile-wallet-detection.vercel.app/
                    </div>
                    <button class="btn" onclick="testDeepLink('phantom')">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                    <button class="btn btn-secondary" onclick="copyDeepLink('phantom-deeplink')">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                </div>

                <div style="margin: 15px 0;">
                    <h4>Phantom —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞:</h4>
                    <div class="deep-link-url" id="phantom-universal">
                        https://phantom.app/ul/v0-mobile-wallet-detection.vercel.app
                    </div>
                    <button class="btn" onclick="testDeepLink('universal')">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                    <button class="btn btn-secondary" onclick="copyDeepLink('phantom-universal')">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                </div>

                <div style="margin: 15px 0;">
                    <h4>WalletConnect deep link:</h4>
                    <div class="deep-link-url" id="walletconnect-deeplink">
                        wc:// (–±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏)
                    </div>
                    <button class="btn" onclick="generateWCDeepLink()">–ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å WC —Å—Å—ã–ª–∫—É</button>
                </div>
            </div>
        </div>

        <!-- Actions Section -->
        <div class="content" id="actions-section" style="display: none;">
            <h2>–î–µ–π—Å—Ç–≤–∏—è —Å –∫–æ—à–µ–ª—å–∫–æ–º</h2>
            
            <div class="wallet-section">
                <h3>–î–æ—Å—Ç—É–ø–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏</h3>
                <button class="btn" onclick="getBalance()">üí∞ –ü–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å</button>
                <button class="btn" onclick="signMessage()">‚úçÔ∏è –ü–æ–¥–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</button>
                <button class="btn" onclick="sendTransaction()">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é</button>
                <button class="btn btn-secondary" onclick="switchNetwork()">üîÑ –°–º–µ–Ω–∏—Ç—å —Å–µ—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- Modal for QR Code -->
    <div id="qrModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('qrModal')">&times;</span>
            <h2>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ QR-–∫–æ–¥</h2>
            <div id="modal-qr-container" style="text-align: center; padding: 20px;">
                <!-- QR –∫–æ–¥ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
            </div>
            <p style="text-align: center; color: #666;">
                –û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ —ç—Ç–æ—Ç QR-–∫–æ–¥ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ Phantom
            </p>
        </div>
    </div>

    <!-- WalletConnect SDK -->
    <script src="https://unpkg.com/@walletconnect/client@1.8.0/dist/index.min.js"></script>
    <script src="https://unpkg.com/qrcode@1.5.3/build/qrcode.min.js"></script>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        const CONFIG = {
            dappUrl: 'https://v0-mobile-wallet-detection.vercel.app/',
            dappName: 'Mobile Wallet Detection',
            dappDescription: 'Test dApp for mobile wallet detection',
            dappIcon: 'https://v0-mobile-wallet-detection.vercel.app/favicon.ico',
            walletConnectProjectId: 'your-project-id', // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à Project ID
        };

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let walletConnector = null;
        let phantomWallet = null;
        let currentConnection = null;

        // –ö–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å WalletConnect
        class WalletConnectManager {
            constructor() {
                this.connector = null;
                this.isConnecting = false;
            }

            async connect() {
                try {
                    this.isConnecting = true;
                    this.updateStatus('connecting', 'üü° –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ WalletConnect...');
                    this.showLoading('wc-loading', 'wc-btn-text', '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...');

                    // –°–æ–∑–¥–∞–µ–º WalletConnect connector
                    this.connector = new WalletConnect({
                        bridge: "https://bridge.walletconnect.org",
                        qrcodeModal: {
                            open: (uri, cb) => {
                                this.showQRCode(uri);
                            },
                            close: () => {
                                this.hideQRCode();
                            }
                        }
                    });

                    // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è
                    this.connector.on("connect", (error, payload) => {
                        if (error) {
                            throw error;
                        }
                        this.onConnect(payload);
                    });

                    this.connector.on("session_update", (error, payload) => {
                        if (error) {
                            throw error;
                        }
                        this.onSessionUpdate(payload);
                    });

                    this.connector.on("disconnect", (error, payload) => {
                        if (error) {
                            throw error;
                        }
                        this.onDisconnect();
                    });

                    // –°–æ–∑–¥–∞–µ–º —Å–µ—Å—Å–∏—é
                    if (!this.connector.connected) {
                        await this.connector.createSession();
                    }

                } catch (error) {
                    console.error('WalletConnect connection error:', error);
                    this.updateStatus('error', `‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${error.message}`);
                    this.hideLoading('wc-loading', 'wc-btn-text', '–ü–æ–¥–∫–ª—é—á–∏—Ç—å WalletConnect');
                    this.isConnecting = false;
                }
            }

            onConnect(payload) {
                console.log('WalletConnect connected:', payload);
                const { accounts, chainId } = payload.params[0];
                
                this.updateStatus('connected', 'üü¢ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ —á–µ—Ä–µ–∑ WalletConnect');
                this.showWalletInfo(accounts[0], chainId);
                this.hideLoading('wc-loading', 'wc-btn-text', '–ü–æ–¥–∫–ª—é—á–µ–Ω–æ');
                
                document.getElementById('wc-disconnect-btn').style.display = 'inline-block';
                document.getElementById('actions-section').style.display = 'block';
                
                currentConnection = 'walletconnect';
                this.isConnecting = false;
            }

            onSessionUpdate(payload) {
                console.log('WalletConnect session updated:', payload);
                const { accounts, chainId } = payload.params[0];
                this.showWalletInfo(accounts[0], chainId);
            }

            onDisconnect() {
                console.log('WalletConnect disconnected');
                this.updateStatus('disconnected', 'üî¥ –ö–æ—à–µ–ª–µ–∫ –æ—Ç–∫–ª—é—á–µ–Ω');
                this.hideWalletInfo();
                this.hideLoading('wc-loading', 'wc-btn-text', '–ü–æ–¥–∫–ª—é—á–∏—Ç—å WalletConnect');
                
                document.getElementById('wc-disconnect-btn').style.display = 'none';
                document.getElementById('actions-section').style.display = 'none';
                
                currentConnection = null;
                this.isConnecting = false;
            }

            async disconnect() {
                if (this.connector) {
                    await this.connector.killSession();
                    this.connector = null;
                }
            }

            showQRCode(uri) {
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º QR –∫–æ–¥
                const qrContainer = document.getElementById('modal-qr-container');
                qrContainer.innerHTML = '';
                
                QRCode.toCanvas(qrContainer, uri, {
                    width: 256,
                    margin: 2,
                    color: {
                        dark: '#000000',
                        light: '#FFFFFF'
                    }
                }, (error) => {
                    if (error) {
                        console.error('QR Code generation error:', error);
                        qrContainer.innerHTML = '<p>–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ QR-–∫–æ–¥–∞</p>';
                    }
                });

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                document.getElementById('qrModal').style.display = 'block';

                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º deep link –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
                this.generateMobileDeepLink(uri);
            }

            hideQRCode() {
                document.getElementById('qrModal').style.display = 'none';
            }

            generateMobileDeepLink(uri) {
                const phantomDeepLink = `phantom://wc?uri=${encodeURIComponent(uri)}`;
                document.getElementById('walletconnect-deeplink').textContent = phantomDeepLink;
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—ã—Ç–∞–µ–º—Å—è –æ—Ç–∫—Ä—ã—Ç—å –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
                if (this.isMobile()) {
                    setTimeout(() => {
                        window.location.href = phantomDeepLink;
                    }, 1000);
                }
            }

            isMobile() {
                return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            }

            updateStatus(type, message) {
                const statusEl = document.getElementById('connection-status');
                statusEl.className = `status ${type}`;
                statusEl.textContent = message;
            }

            showWalletInfo(address, chainId) {
                document.getElementById('wallet-address').textContent = address;
                document.getElementById('wallet-network').textContent = chainId === 1 ? 'Mainnet' : `Chain ${chainId}`;
                document.getElementById('wallet-info').style.display = 'block';
                
                // –ü–æ–ª—É—á–∞–µ–º –±–∞–ª–∞–Ω—Å
                this.getBalance(address);
            }

            hideWalletInfo() {
                document.getElementById('wallet-info').style.display = 'none';
            }

            async getBalance(address) {
                try {
                    // –ó–¥–µ—Å—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—Ä–æ—Å –∫ Solana RPC –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
                    // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–≥–ª—É—à–∫—É
                    document.getElementById('wallet-balance').textContent = '0.00';
                } catch (error) {
                    console.error('Error getting balance:', error);
                    document.getElementById('wallet-balance').textContent = '–û—à–∏–±–∫–∞';
                }
            }

            showLoading(loadingId, textId, loadingText) {
                document.getElementById(loadingId).style.display = 'inline-block';
                document.getElementById(textId).textContent = loadingText;
            }

            hideLoading(loadingId, textId, defaultText) {
                document.getElementById(loadingId).style.display = 'none';
                document.getElementById(textId).textContent = defaultText;
            }
        }

        // –ö–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Phantom –Ω–∞–ø—Ä—è–º—É—é
        class PhantomManager {
            constructor() {
                this.wallet = null;
            }

            async connect() {
                try {
                    this.showLoading('phantom-loading', 'phantom-btn-text', '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...');
                    this.updateStatus('connecting', 'üü° –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Phantom...');

                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ Phantom
                    if (!window.phantom?.solana) {
                        throw new Error('Phantom –∫–æ—à–µ–ª–µ–∫ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
                    }

                    this.wallet = window.phantom.solana;

                    // –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è
                    const response = await this.wallet.connect();
                    console.log('Phantom connected:', response);

                    this.updateStatus('connected', 'üü¢ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ Phantom');
                    this.showWalletInfo(response.publicKey.toString());
                    this.hideLoading('phantom-loading', 'phantom-btn-text', '–ü–æ–¥–∫–ª—é—á–µ–Ω–æ');
                    
                    document.getElementById('phantom-disconnect-btn').style.display = 'inline-block';
                    document.getElementById('actions-section').style.display = 'block';
                    
                    currentConnection = 'phantom';

                } catch (error) {
                    console.error('Phantom connection error:', error);
                    this.updateStatus('error', `‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${error.message}`);
                    this.hideLoading('phantom-loading', 'phantom-btn-text', '–ü–æ–¥–∫–ª—é—á–∏—Ç—å Phantom');
                }
            }

            async disconnect() {
                if (this.wallet) {
                    try {
                        await this.wallet.disconnect();
                    } catch (error) {
                        console.error('Phantom disconnect error:', error);
                    }
                    this.wallet = null;
                }
                
                this.updateStatus('disconnected', 'üî¥ –ö–æ—à–µ–ª–µ–∫ –æ—Ç–∫–ª—é—á–µ–Ω');
                this.hideWalletInfo();
                this.hideLoading('phantom-loading', 'phantom-btn-text', '–ü–æ–¥–∫–ª—é—á–∏—Ç—å Phantom');
                
                document.getElementById('phantom-disconnect-btn').style.display = 'none';
                document.getElementById('actions-section').style.display = 'none';
                
                currentConnection = null;
            }

            updateStatus(type, message) {
                const statusEl = document.getElementById('connection-status');
                statusEl.className = `status ${type}`;
                statusEl.textContent = message;
            }

            showWalletInfo(address) {
                document.getElementById('wallet-address').textContent = address;
                document.getElementById('wallet-network').textContent = 'Solana Mainnet';
                document.getElementById('wallet-info').style.display = 'block';
                
                this.getBalance(address);
            }

            hideWalletInfo() {
                document.getElementById('wallet-info').style.display = 'none';
            }

            async getBalance(address) {
                try {
                    if (this.wallet) {
                        const balance = await this.wallet.getBalance();
                        document.getElementById('wallet-balance').textContent = (balance / 1e9).toFixed(4);
                    }
                } catch (error) {
                    console.error('Error getting balance:', error);
                    document.getElementById('wallet-balance').textContent = '–û—à–∏–±–∫–∞';
                }
            }

            showLoading(loadingId, textId, loadingText) {
                document.getElementById(loadingId).style.display = 'inline-block';
                document.getElementById(textId).textContent = loadingText;
            }

            hideLoading(loadingId, textId, defaultText) {
                document.getElementById(loadingId).style.display = 'none';
                document.getElementById(textId).textContent = defaultText;
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
        const walletConnectManager = new WalletConnectManager();
        const phantomManager = new PhantomManager();

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        async function connectWalletConnect() {
            await walletConnectManager.connect();
        }

        async function disconnectWalletConnect() {
            await walletConnectManager.disconnect();
        }

        async function connectPhantomDirect() {
            await phantomManager.connect();
        }

        async function disconnectPhantom() {
            await phantomManager.disconnect();
        }

        function openPhantomDeepLink() {
            const deepLink = `phantom://open?url=${encodeURIComponent(CONFIG.dappUrl)}`;
            window.location.href = deepLink;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã, –µ—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –æ—Ç–∫—Ä—ã–ª–æ—Å—å
            setTimeout(() => {
                alert('–ï—Å–ª–∏ Phantom –Ω–µ –æ—Ç–∫—Ä—ã–ª—Å—è, —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
            }, 2000);
        }

        function openPhantomBrowser() {
            const universalLink = `https://phantom.app/ul/${CONFIG.dappUrl.replace('https://', '')}`;
            window.open(universalLink, '_blank');
        }

        function testDeepLink(type) {
            let url;
            if (type === 'phantom') {
                url = document.getElementById('phantom-deeplink').textContent;
            } else if (type === 'universal') {
                url = document.getElementById('phantom-universal').textContent;
            }
            
            window.location.href = url;
        }

        function copyDeepLink(elementId) {
            const text = document.getElementById(elementId).textContent;
            navigator.clipboard.writeText(text).then(() => {
                alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
            });
        }

        function generateWCDeepLink() {
            if (walletConnectManager.connector && walletConnectManager.connector.uri) {
                const wcUri = walletConnectManager.connector.uri;
                const phantomWCLink = `phantom://wc?uri=${encodeURIComponent(wcUri)}`;
                document.getElementById('walletconnect-deeplink').textContent = phantomWCLink;
                alert('WalletConnect deep link —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω!');
            } else {
                alert('–°–Ω–∞—á–∞–ª–∞ –∏–Ω–∏—Ü–∏–∏—Ä—É–π—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ WalletConnect');
            }
        }

        // –î–µ–π—Å—Ç–≤–∏—è —Å –∫–æ—à–µ–ª—å–∫–æ–º
        async function getBalance() {
            if (currentConnection === 'phantom' && phantomManager.wallet) {
                try {
                    const balance = await phantomManager.wallet.getBalance();
                    alert(`–ë–∞–ª–∞–Ω—Å: ${(balance / 1e9).toFixed(4)} SOL`);
                } catch (error) {
                    alert(`–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞: ${error.message}`);
                }
            } else if (currentConnection === 'walletconnect') {
                alert('–ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ —á–µ—Ä–µ–∑ WalletConnect (—Ç—Ä–µ–±—É–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)');
            } else {
                alert('–ö–æ—à–µ–ª–µ–∫ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω');
            }
        }

        async function signMessage() {
            const message = '–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ø–æ–¥–ø–∏—Å–∏';
            
            if (currentConnection === 'phantom' && phantomManager.wallet) {
                try {
                    const encodedMessage = new TextEncoder().encode(message);
                    const signature = await phantomManager.wallet.signMessage(encodedMessage);
                    alert(`–°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∞–Ω–æ! –ü–æ–¥–ø–∏—Å—å: ${signature.signature}`);
                } catch (error) {
                    alert(`–û—à–∏–±–∫–∞ –ø–æ–¥–ø–∏—Å–∏: ${error.message}`);
                }
            } else if (currentConnection === 'walletconnect') {
                alert('–ü–æ–¥–ø–∏—Å—å —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ WalletConnect (—Ç—Ä–µ–±—É–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)');
            } else {
                alert('–ö–æ—à–µ–ª–µ–∫ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω');
            }
        }

        async function sendTransaction() {
            alert('–û—Ç–ø—Ä–∞–≤–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–¥–µ–º–æ —Ñ—É–Ω–∫—Ü–∏—è)');
        }

        function switchNetwork() {
            alert('–°–º–µ–Ω–∞ —Å–µ—Ç–∏ (–¥–µ–º–æ —Ñ—É–Ω–∫—Ü–∏—è)');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Phantom WalletConnect dApp –∑–∞–≥—Ä—É–∂–µ–Ω');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ Phantom
            if (window.phantom?.solana) {
                console.log('Phantom –∫–æ—à–µ–ª–µ–∫ –æ–±–Ω–∞—Ä—É–∂–µ–Ω');
            } else {
                console.log('Phantom –∫–æ—à–µ–ª–µ–∫ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω');
            }
        });
    </script>
</body>
</html>
